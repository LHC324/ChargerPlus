C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Src\main.c LARGE OPTIMIZE(9,SPEED) BROWSE FLOATFUZZY(4) INCDIR(.\Inc) DE
                    -BUG OBJECTEXTEND CODE LISTINCLUDE SYMBOLS PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "GPIO.h"
   1      =1  
   2      =1  #ifndef __GPIO_H_
   3      =1  #define __GPIO_H_
   4      =1  #include "config.h"
   1      =2  #ifndef __CONFIG_H_
   2      =2  #define __CONFIG_H_
   3      =2  
   4      =2  #include <STC8.H>
   1      =3  #ifndef __STC8F_H_
   2      =3  #define __STC8F_H_
   3      =3  
   4      =3  /////////////////////////////////////////////////
   5      =3  
   6      =3  //包含本头文件后,不用另外再包含"REG51.H"
   7      =3  
   8      =3  //内核特殊功能寄存器
   9      =3  sfr ACC         =   0xe0;
  10      =3  sfr B           =   0xf0;
  11      =3  sfr PSW         =   0xd0;
  12      =3  sbit CY         =   PSW^7;
  13      =3  sbit AC         =   PSW^6;
  14      =3  sbit F0         =   PSW^5;
  15      =3  sbit RS1        =   PSW^4;
  16      =3  sbit RS0        =   PSW^3;
  17      =3  sbit OV         =   PSW^2;
  18      =3  sbit P          =   PSW^0;
  19      =3  sfr SP          =   0x81;
  20      =3  sfr DPL         =   0x82;
  21      =3  sfr DPH         =   0x83;
  22      =3  sfr TA          =   0xae;
  23      =3  sfr DPS         =   0xe3;
  24      =3  sfr DPL1        =   0xe4;
  25      =3  sfr DPH1        =   0xe5;
  26      =3  
  27      =3  
  28      =3  //I/O 口特殊功能寄存器
  29      =3  sfr P0          =   0x80;
  30      =3  sfr P1          =   0x90;
  31      =3  sfr P2          =   0xa0;
  32      =3  sfr P3          =   0xb0;
  33      =3  sfr P4          =   0xc0;
  34      =3  sfr P5          =   0xc8;
  35      =3  sfr P6          =   0xe8;
  36      =3  sfr P7          =   0xf8;
  37      =3  sfr P0M0        =   0x94;
  38      =3  sfr P0M1        =   0x93;
  39      =3  sfr P1M0        =   0x92;
  40      =3  sfr P1M1        =   0x91;
  41      =3  sfr P2M0        =   0x96;
  42      =3  sfr P2M1        =   0x95;
  43      =3  sfr P3M0        =   0xb2;
  44      =3  sfr P3M1        =   0xb1;
  45      =3  sfr P4M0        =   0xb4;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 2   

  46      =3  sfr P4M1        =   0xb3;
  47      =3  sfr P5M0        =   0xca;
  48      =3  sfr P5M1        =   0xc9;
  49      =3  sfr P6M0        =   0xcc;
  50      =3  sfr P6M1        =   0xcb;
  51      =3  sfr P7M0        =   0xe2;
  52      =3  sfr P7M1        =   0xe1;
  53      =3  
  54      =3  sbit P00        =   P0^0;
  55      =3  sbit P01        =   P0^1;
  56      =3  sbit P02        =   P0^2;
  57      =3  sbit P03        =   P0^3;
  58      =3  sbit P04        =   P0^4;
  59      =3  sbit P05        =   P0^5;
  60      =3  sbit P06        =   P0^6;
  61      =3  sbit P07        =   P0^7;
  62      =3  sbit P10        =   P1^0;
  63      =3  sbit P11        =   P1^1;
  64      =3  sbit P12        =   P1^2;
  65      =3  sbit P13        =   P1^3;
  66      =3  sbit P14        =   P1^4;
  67      =3  sbit P15        =   P1^5;
  68      =3  sbit P16        =   P1^6;
  69      =3  sbit P17        =   P1^7;
  70      =3  sbit P20        =   P2^0;
  71      =3  sbit P21        =   P2^1;
  72      =3  sbit P22        =   P2^2;
  73      =3  sbit P23        =   P2^3;
  74      =3  sbit P24        =   P2^4;
  75      =3  sbit P25        =   P2^5;
  76      =3  sbit P26        =   P2^6;
  77      =3  sbit P27        =   P2^7;
  78      =3  sbit P30        =   P3^0;
  79      =3  sbit P31        =   P3^1;
  80      =3  sbit P32        =   P3^2;
  81      =3  sbit P33        =   P3^3;
  82      =3  sbit P34        =   P3^4;
  83      =3  sbit P35        =   P3^5;
  84      =3  sbit P36        =   P3^6;
  85      =3  sbit P37        =   P3^7;
  86      =3  sbit P40        =   P4^0;
  87      =3  sbit P41        =   P4^1;
  88      =3  sbit P42        =   P4^2;
  89      =3  sbit P43        =   P4^3;
  90      =3  sbit P44        =   P4^4;
  91      =3  sbit P45        =   P4^5;
  92      =3  sbit P46        =   P4^6;
  93      =3  sbit P47        =   P4^7;
  94      =3  sbit P50        =   P5^0;
  95      =3  sbit P51        =   P5^1;
  96      =3  sbit P52        =   P5^2;
  97      =3  sbit P53        =   P5^3;
  98      =3  sbit P54        =   P5^4;
  99      =3  sbit P55        =   P5^5;
 100      =3  sbit P56        =   P5^6;
 101      =3  sbit P57        =   P5^7;
 102      =3  sbit P60        =   P6^0;
 103      =3  sbit P61        =   P6^1;
 104      =3  sbit P62        =   P6^2;
 105      =3  sbit P63        =   P6^3;
 106      =3  sbit P64        =   P6^4;
 107      =3  sbit P65        =   P6^5;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 3   

 108      =3  sbit P66        =   P6^6;
 109      =3  sbit P67        =   P6^7;
 110      =3  sbit P70        =   P7^0;
 111      =3  sbit P71        =   P7^1;
 112      =3  sbit P72        =   P7^2;
 113      =3  sbit P73        =   P7^3;
 114      =3  sbit P74        =   P7^4;
 115      =3  sbit P75        =   P7^5;
 116      =3  sbit P76        =   P7^6;
 117      =3  sbit P77        =   P7^7;
 118      =3  
 119      =3  //如下特殊功能寄存器位于扩展RAM区域
 120      =3  //访问这些寄存器,需先将P_SW2的BIT7设置为1,才可正常读写
 121      =3  #define P0PU        (*(unsigned char volatile xdata *)0xfe10)
 122      =3  #define P1PU        (*(unsigned char volatile xdata *)0xfe11)
 123      =3  #define P2PU        (*(unsigned char volatile xdata *)0xfe12)
 124      =3  #define P3PU        (*(unsigned char volatile xdata *)0xfe13)
 125      =3  #define P4PU        (*(unsigned char volatile xdata *)0xfe14)
 126      =3  #define P5PU        (*(unsigned char volatile xdata *)0xfe15)
 127      =3  #define P6PU        (*(unsigned char volatile xdata *)0xfe16)
 128      =3  #define P7PU        (*(unsigned char volatile xdata *)0xfe17)
 129      =3  #define P0NCS       (*(unsigned char volatile xdata *)0xfe18)
 130      =3  #define P1NCS       (*(unsigned char volatile xdata *)0xfe19)
 131      =3  #define P2NCS       (*(unsigned char volatile xdata *)0xfe1a)
 132      =3  #define P3NCS       (*(unsigned char volatile xdata *)0xfe1b)
 133      =3  #define P4NCS       (*(unsigned char volatile xdata *)0xfe1c)
 134      =3  #define P5NCS       (*(unsigned char volatile xdata *)0xfe1d)
 135      =3  #define P6NCS       (*(unsigned char volatile xdata *)0xfe1e)
 136      =3  #define P7NCS       (*(unsigned char volatile xdata *)0xfe1f)
 137      =3  
 138      =3  //系统管理特殊功能寄存器
 139      =3  sfr PCON        =   0x87;
 140      =3  #define SMOD        0x80
 141      =3  #define SMOD0       0x40
 142      =3  #define LVDF        0x20
 143      =3  #define POF         0x10
 144      =3  #define GF1         0x08
 145      =3  #define GF0         0x04
 146      =3  #define PD          0x02
 147      =3  #define IDL         0x01
 148      =3  sfr AUXR        =   0x8e;
 149      =3  #define T0x12       0x80
 150      =3  #define T1x12       0x40
 151      =3  #define UART_M0x6   0x20
 152      =3  #define T2R         0x10
 153      =3  #define T2_CT       0x08
 154      =3  #define T2x12       0x04
 155      =3  #define EXTRAM      0x02
 156      =3  #define S1ST2       0x01
 157      =3  sfr AUXR2       =   0x97;
 158      =3  #define TXLNRX      0x10
 159      =3  sfr BUS_SPEED   =   0xa1;
 160      =3  sfr P_SW1       =   0xa2;
 161      =3  sfr P_SW2       =   0xba;
 162      =3  #define EAXFR       0x80
 163      =3  sfr VOCTRL      =   0xbb;
 164      =3  sfr RSTCFG      =   0xff;
 165      =3  
 166      =3  //如下特殊功能寄存器位于扩展RAM区域
 167      =3  //访问这些寄存器,需先将P_SW2的BIT7设置为1,才可正常读写
 168      =3  #define CKSEL       (*(unsigned char volatile xdata *)0xfe00)
 169      =3  #define CLKDIV      (*(unsigned char volatile xdata *)0xfe01)
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 4   

 170      =3  #define IRC24MCR    (*(unsigned char volatile xdata *)0xfe02)
 171      =3  #define XOSCCR      (*(unsigned char volatile xdata *)0xfe03)
 172      =3  #define IRC32KCR    (*(unsigned char volatile xdata *)0xfe04)
 173      =3  
 174      =3  //中断特殊功能寄存器
 175      =3  sfr IE          =   0xa8;
 176      =3  sbit EA         =   IE^7;
 177      =3  sbit ELVD       =   IE^6;
 178      =3  sbit EADC       =   IE^5;
 179      =3  sbit ES         =   IE^4;
 180      =3  sbit ET1        =   IE^3;
 181      =3  sbit EX1        =   IE^2;
 182      =3  sbit ET0        =   IE^1;
 183      =3  sbit EX0        =   IE^0;
 184      =3  sfr IE2         =   0xaf;
 185      =3  #define ET4         0x40
 186      =3  #define ET3         0x20
 187      =3  #define ES4         0x10
 188      =3  #define ES3         0x08
 189      =3  #define ET2         0x04
 190      =3  #define ESPI        0x02
 191      =3  #define ES2         0x01
 192      =3  sfr IP          =   0xb8;
 193      =3  sbit PPCA       =   IP^7;
 194      =3  sbit PLVD       =   IP^6;
 195      =3  sbit PADC       =   IP^5;
 196      =3  sbit PS         =   IP^4;
 197      =3  sbit PT1        =   IP^3;
 198      =3  sbit PX1        =   IP^2;
 199      =3  sbit PT0        =   IP^1;
 200      =3  sbit PX0        =   IP^0;
 201      =3  sfr IP2         =   0xb5;
 202      =3  #define PI2C        0x40
 203      =3  #define PCMP        0x20
 204      =3  #define PX4         0x10
 205      =3  #define PPWMFD      0x08
 206      =3  #define PPWM        0x04
 207      =3  #define PSPI        0x02
 208      =3  #define PS2         0x01
 209      =3  sfr IPH         =   0xb7;
 210      =3  #define PPCAH       0x80
 211      =3  #define PLVDH       0x40
 212      =3  #define PADCH       0x20
 213      =3  #define PSH         0x10
 214      =3  #define PT1H        0x08
 215      =3  #define PX1H        0x04
 216      =3  #define PT0H        0x02
 217      =3  #define PX0H        0x01
 218      =3  sfr IP2H        =   0xb6;
 219      =3  #define PI2CH       0x40
 220      =3  #define PCMPH       0x20
 221      =3  #define PX4H        0x10
 222      =3  #define PPWMFDH     0x08
 223      =3  #define PPWMH       0x04
 224      =3  #define PSPIH       0x02
 225      =3  #define PS2H        0x01
 226      =3  sfr INTCLKO     =   0x8f;
 227      =3  #define EX4         0x40
 228      =3  #define EX3         0x20
 229      =3  #define EX2         0x10
 230      =3  #define T2CLKO      0x04
 231      =3  #define T1CLKO      0x02
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 5   

 232      =3  #define T0CLKO      0x01
 233      =3  sfr AUXINTIF    =   0xef;
 234      =3  #define INT4IF      0x40
 235      =3  #define INT3IF      0x20
 236      =3  #define INT2IF      0x10
 237      =3  #define T4IF        0x04
 238      =3  #define T3IF        0x02
 239      =3  #define T2IF        0x01
 240      =3  
 241      =3  //定时器特殊功能寄存器
 242      =3  sfr TCON        =   0x88;
 243      =3  sbit TF1        =   TCON^7;
 244      =3  sbit TR1        =   TCON^6;
 245      =3  sbit TF0        =   TCON^5;
 246      =3  sbit TR0        =   TCON^4;
 247      =3  sbit IE1        =   TCON^3;
 248      =3  sbit IT1        =   TCON^2;
 249      =3  sbit IE0        =   TCON^1;
 250      =3  sbit IT0        =   TCON^0;
 251      =3  sfr TMOD        =   0x89;
 252      =3  #define T1_GATE     0x80
 253      =3  #define T1_CT       0x40
 254      =3  #define T1_M1       0x20
 255      =3  #define T1_M0       0x10
 256      =3  #define T0_GATE     0x08
 257      =3  #define T0_CT       0x04
 258      =3  #define T0_M1       0x02
 259      =3  #define T0_M0       0x01
 260      =3  sfr TL0         =   0x8a;
 261      =3  sfr TL1         =   0x8b;
 262      =3  sfr TH0         =   0x8c;
 263      =3  sfr TH1         =   0x8d;
 264      =3  sfr T4T3M       =   0xd1;
 265      =3  #define T4R         0x80
 266      =3  #define T4_CT       0x40
 267      =3  #define T4x12       0x20
 268      =3  #define T4CLKO      0x10
 269      =3  #define T3R         0x08
 270      =3  #define T3_CT       0x04
 271      =3  #define T3x12       0x02
 272      =3  #define T3CLKO      0x01
 273      =3  sfr T4H         =   0xd2;
 274      =3  sfr T4L         =   0xd3;
 275      =3  sfr T3H         =   0xd4;
 276      =3  sfr T3L         =   0xd5;
 277      =3  sfr T2H         =   0xd6;
 278      =3  sfr T2L         =   0xd7;
 279      =3  sfr TH4         =   0xd2;
 280      =3  sfr TL4         =   0xd3;
 281      =3  sfr TH3         =   0xd4;
 282      =3  sfr TL3         =   0xd5;
 283      =3  sfr TH2         =   0xd6;
 284      =3  sfr TL2         =   0xd7;
 285      =3  sfr WKTCL       =   0xaa;
 286      =3  sfr WKTCH       =   0xab;
 287      =3  #define WKTEN       0x80
 288      =3  sfr WDT_CONTR   =   0xc1;
 289      =3  #define WDT_FLAG    0x80
 290      =3  #define EN_WDT      0x20
 291      =3  #define CLR_WDT     0x10
 292      =3  #define IDL_WDT     0x08
 293      =3  
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 6   

 294      =3  //串行口特殊功能寄存器
 295      =3  sfr SCON        =   0x98;
 296      =3  sbit SM0        =   SCON^7;
 297      =3  sbit SM1        =   SCON^6;
 298      =3  sbit SM2        =   SCON^5;
 299      =3  sbit REN        =   SCON^4;
 300      =3  sbit TB8        =   SCON^3;
 301      =3  sbit RB8        =   SCON^2;
 302      =3  sbit TI         =   SCON^1;
 303      =3  sbit RI         =   SCON^0;
 304      =3  sfr SBUF        =   0x99;
 305      =3  sfr S2CON       =   0x9a;
 306      =3  #define S2SM0       0x80
 307      =3  #define S2ST4       0x40
 308      =3  #define S2SM2       0x20
 309      =3  #define S2REN       0x10
 310      =3  #define S2TB8       0x08
 311      =3  #define S2RB8       0x04
 312      =3  #define S2TI        0x02
 313      =3  #define S2RI        0x01
 314      =3  sfr S2BUF       =   0x9b;
 315      =3  sfr S3CON       =   0xac;
 316      =3  #define S3SM0       0x80
 317      =3  #define S3ST4       0x40
 318      =3  #define S3SM2       0x20
 319      =3  #define S3REN       0x10
 320      =3  #define S3TB8       0x08
 321      =3  #define S3RB8       0x04
 322      =3  #define S3TI        0x02
 323      =3  #define S3RI        0x01
 324      =3  sfr S3BUF       =   0xad;
 325      =3  sfr S4CON       =   0x84;
 326      =3  #define S4SM0       0x80
 327      =3  #define S4ST4       0x40
 328      =3  #define S4SM2       0x20
 329      =3  #define S4REN       0x10
 330      =3  #define S4TB8       0x08
 331      =3  #define S4RB8       0x04
 332      =3  #define S4TI        0x02
 333      =3  #define S4RI        0x01
 334      =3  sfr S4BUF       =   0x85;
 335      =3  sfr SADDR       =   0xa9;
 336      =3  sfr SADEN       =   0xb9;
 337      =3  
 338      =3  //ADC 特殊功能寄存器
 339      =3  sfr ADC_CONTR   =   0xbc;
 340      =3  #define ADC_POWER   0x80
 341      =3  #define ADC_START   0x40
 342      =3  #define ADC_FLAG    0x20
 343      =3  sfr ADC_RES     =   0xbd;
 344      =3  sfr ADC_RESL    =   0xbe;
 345      =3  sfr ADCCFG      =   0xde;
 346      =3  #define ADC_RESFMT  0x20
 347      =3  
 348      =3  //SPI 特殊功能寄存器
 349      =3  sfr SPSTAT      =   0xcd;
 350      =3  #define SPIF        0x80
 351      =3  #define WCOL        0x40
 352      =3  sfr SPCTL       =   0xce;
 353      =3  #define SSIG        0x80
 354      =3  #define SPEN        0x40
 355      =3  #define DORD        0x20
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 7   

 356      =3  #define MSTR        0x10
 357      =3  #define CPOL        0x08
 358      =3  #define CPHA        0x04
 359      =3  sfr SPDAT       =   0xcf;
 360      =3  
 361      =3  //IAP/ISP 特殊功能寄存器
 362      =3  sfr IAP_DATA    =   0xc2;
 363      =3  sfr IAP_ADDRH   =   0xc3;
 364      =3  sfr IAP_ADDRL   =   0xc4;
 365      =3  sfr IAP_CMD     =   0xc5;
 366      =3  #define IAP_IDL     0x00
 367      =3  #define IAP_READ    0x01
 368      =3  #define IAP_WRITE   0x02
 369      =3  #define IAP_ERASE   0x03
 370      =3  sfr IAP_TRIG    =   0xc6;
 371      =3  sfr IAP_CONTR   =   0xc7;
 372      =3  #define IAPEN       0x80
 373      =3  #define SWBS        0x40
 374      =3  #define SWRST       0x20
 375      =3  #define CMD_FAIL    0x10
 376      =3  sfr ISP_DATA    =   0xc2;
 377      =3  sfr ISP_ADDRH   =   0xc3;
 378      =3  sfr ISP_ADDRL   =   0xc4;
 379      =3  sfr ISP_CMD     =   0xc5;
 380      =3  sfr ISP_TRIG    =   0xc6;
 381      =3  sfr ISP_CONTR   =   0xc7;
 382      =3  
 383      =3  //比较器特殊功能寄存器
 384      =3  sfr CMPCR1      =   0xe6;
 385      =3  #define CMPEN       0x80
 386      =3  #define CMPIF       0x40
 387      =3  #define PIE         0x20
 388      =3  #define NIE         0x10
 389      =3  #define PIS         0x08
 390      =3  #define NIS         0x04
 391      =3  #define CMPOE       0x02
 392      =3  #define CMPRES      0x01
 393      =3  sfr CMPCR2      =   0xe7;
 394      =3  #define INVCMPO     0x80
 395      =3  #define DISFLT      0x40
 396      =3  
 397      =3  //PCA/PWM 特殊功能寄存器
 398      =3  sfr CCON        =   0xd8;
 399      =3  sbit CF         =   CCON^7;
 400      =3  sbit CR         =   CCON^6;
 401      =3  sbit CCF3       =   CCON^3;
 402      =3  sbit CCF2       =   CCON^2;
 403      =3  sbit CCF1       =   CCON^1;
 404      =3  sbit CCF0       =   CCON^0;
 405      =3  sfr CMOD        =   0xd9;
 406      =3  #define CIDL        0x80
 407      =3  #define ECF         0x01
 408      =3  sfr CL          =   0xe9;
 409      =3  sfr CH          =   0xf9;
 410      =3  sfr CCAPM0      =   0xda;
 411      =3  #define ECOM0       0x40
 412      =3  #define CCAPP0      0x20
 413      =3  #define CCAPN0      0x10
 414      =3  #define MAT0        0x08
 415      =3  #define TOG0        0x04
 416      =3  #define PWM0        0x02
 417      =3  #define ECCF0       0x01
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 8   

 418      =3  sfr CCAPM1      =   0xdb;
 419      =3  #define ECOM1       0x40
 420      =3  #define CCAPP1      0x20
 421      =3  #define CCAPN1      0x10
 422      =3  #define MAT1        0x08
 423      =3  #define TOG1        0x04
 424      =3  #define PWM1        0x02
 425      =3  #define ECCF1       0x01
 426      =3  sfr CCAPM2      =   0xdc;
 427      =3  #define ECOM2       0x40
 428      =3  #define CCAPP2      0x20
 429      =3  #define CCAPN2      0x10
 430      =3  #define MAT2        0x08
 431      =3  #define TOG2        0x04
 432      =3  #define PWM2        0x02
 433      =3  #define ECCF2       0x01
 434      =3  sfr CCAPM3      =   0xdd;
 435      =3  #define ECOM3       0x40
 436      =3  #define CCAPP3      0x20
 437      =3  #define CCAPN3      0x10
 438      =3  #define MAT3        0x08
 439      =3  #define TOG3        0x04
 440      =3  #define PWM3        0x02
 441      =3  #define ECCF3       0x01
 442      =3  sfr CCAP0L      =   0xea;
 443      =3  sfr CCAP1L      =   0xeb;
 444      =3  sfr CCAP2L      =   0xec;
 445      =3  sfr CCAP3L      =   0xed;
 446      =3  sfr CCAP0H      =   0xfa;
 447      =3  sfr CCAP1H      =   0xfb;
 448      =3  sfr CCAP2H      =   0xfc;
 449      =3  sfr CCAP3H      =   0xfd;
 450      =3  sfr PCA_PWM0    =   0xf2;
 451      =3  sfr PCA_PWM1    =   0xf3;
 452      =3  sfr PCA_PWM2    =   0xf4;
 453      =3  sfr PCA_PWM3    =   0xf5;
 454      =3  
 455      =3  //增强型PWM波形发生器特殊功能寄存器
 456      =3  sfr PWMCFG      =   0xf1;
 457      =3  #define CBIF        0x80
 458      =3  #define ETADC       0x40
 459      =3  sfr PWMIF       =   0xf6;
 460      =3  #define C7IF        0x80
 461      =3  #define C6IF        0x40
 462      =3  #define C5IF        0x20
 463      =3  #define C4IF        0x10
 464      =3  #define C3IF        0x08
 465      =3  #define C2IF        0x04
 466      =3  #define C1IF        0x02
 467      =3  #define C0IF        0x01
 468      =3  sfr PWMFDCR     =   0xf7;
 469      =3  #define INVCMP      0x80
 470      =3  #define INVIO       0x40
 471      =3  #define ENFD        0x20
 472      =3  #define FLTFLIO     0x10
 473      =3  #define EFDI        0x08
 474      =3  #define FDCMP       0x04
 475      =3  #define FDIO        0x02
 476      =3  #define FDIF        0x01
 477      =3  sfr PWMCR       =   0xfe;
 478      =3  #define ENPWM       0x80
 479      =3  #define ECBI        0x40
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 9   

 480      =3  
 481      =3  //如下特殊功能寄存器位于扩展RAM区域
 482      =3  //访问这些寄存器,需先将P_SW2的BIT7设置为1,才可正常读写
 483      =3  #define PWMC        (*(unsigned int  volatile xdata *)0xfff0)
 484      =3  #define PWMCH       (*(unsigned char volatile xdata *)0xfff0)
 485      =3  #define PWMCL       (*(unsigned char volatile xdata *)0xfff1)
 486      =3  #define PWMCKS      (*(unsigned char volatile xdata *)0xfff2)
 487      =3  #define TADCP       (*(unsigned char volatile xdata *)0xfff3)
 488      =3  #define TADCPH      (*(unsigned char volatile xdata *)0xfff3)
 489      =3  #define TADCPL      (*(unsigned char volatile xdata *)0xfff4)
 490      =3  #define PWM0T1      (*(unsigned int  volatile xdata *)0xff00)
 491      =3  #define PWM0T1H     (*(unsigned char volatile xdata *)0xff00)
 492      =3  #define PWM0T1L     (*(unsigned char volatile xdata *)0xff01)
 493      =3  #define PWM0T2      (*(unsigned int  volatile xdata *)0xff02)
 494      =3  #define PWM0T2H     (*(unsigned char volatile xdata *)0xff02)
 495      =3  #define PWM0T2L     (*(unsigned char volatile xdata *)0xff03)
 496      =3  #define PWM0CR      (*(unsigned char volatile xdata *)0xff04)
 497      =3  #define PWM0HLD     (*(unsigned char volatile xdata *)0xff05)
 498      =3  #define PWM1T1      (*(unsigned int  volatile xdata *)0xff10)
 499      =3  #define PWM1T1H     (*(unsigned char volatile xdata *)0xff10)
 500      =3  #define PWM1T1L     (*(unsigned char volatile xdata *)0xff11)
 501      =3  #define PWM1T2      (*(unsigned int  volatile xdata *)0xff12)
 502      =3  #define PWM1T2H     (*(unsigned char volatile xdata *)0xff12)
 503      =3  #define PWM1T2L     (*(unsigned char volatile xdata *)0xff13)
 504      =3  #define PWM1CR      (*(unsigned char volatile xdata *)0xff14)
 505      =3  #define PWM1HLD     (*(unsigned char volatile xdata *)0xff15)
 506      =3  #define PWM2T1      (*(unsigned int  volatile xdata *)0xff20)
 507      =3  #define PWM2T1H     (*(unsigned char volatile xdata *)0xff20)
 508      =3  #define PWM2T1L     (*(unsigned char volatile xdata *)0xff21)
 509      =3  #define PWM2T2      (*(unsigned int  volatile xdata *)0xff22)
 510      =3  #define PWM2T2H     (*(unsigned char volatile xdata *)0xff22)
 511      =3  #define PWM2T2L     (*(unsigned char volatile xdata *)0xff23)
 512      =3  #define PWM2CR      (*(unsigned char volatile xdata *)0xff24)
 513      =3  #define PWM2HLD     (*(unsigned char volatile xdata *)0xff25)
 514      =3  #define PWM3T1      (*(unsigned int  volatile xdata *)0xff30)
 515      =3  #define PWM3T1H     (*(unsigned char volatile xdata *)0xff30)
 516      =3  #define PWM3T1L     (*(unsigned char volatile xdata *)0xff31)
 517      =3  #define PWM3T2      (*(unsigned int  volatile xdata *)0xff32)
 518      =3  #define PWM3T2H     (*(unsigned char volatile xdata *)0xff32)
 519      =3  #define PWM3T2L     (*(unsigned char volatile xdata *)0xff33)
 520      =3  #define PWM3CR      (*(unsigned char volatile xdata *)0xff34)
 521      =3  #define PWM3HLD     (*(unsigned char volatile xdata *)0xff35)
 522      =3  #define PWM4T1      (*(unsigned int  volatile xdata *)0xff40)
 523      =3  #define PWM4T1H     (*(unsigned char volatile xdata *)0xff40)
 524      =3  #define PWM4T1L     (*(unsigned char volatile xdata *)0xff41)
 525      =3  #define PWM4T2      (*(unsigned int  volatile xdata *)0xff42)
 526      =3  #define PWM4T2H     (*(unsigned char volatile xdata *)0xff42)
 527      =3  #define PWM4T2L     (*(unsigned char volatile xdata *)0xff43)
 528      =3  #define PWM4CR      (*(unsigned char volatile xdata *)0xff44)
 529      =3  #define PWM4HLD     (*(unsigned char volatile xdata *)0xff45)
 530      =3  #define PWM5T1      (*(unsigned int  volatile xdata *)0xff50)
 531      =3  #define PWM5T1H     (*(unsigned char volatile xdata *)0xff50)
 532      =3  #define PWM5T1L     (*(unsigned char volatile xdata *)0xff51)
 533      =3  #define PWM5T2      (*(unsigned int  volatile xdata *)0xff52)
 534      =3  #define PWM5T2H     (*(unsigned char volatile xdata *)0xff52)
 535      =3  #define PWM5T2L     (*(unsigned char volatile xdata *)0xff53)
 536      =3  #define PWM5CR      (*(unsigned char volatile xdata *)0xff54)
 537      =3  #define PWM5HLD     (*(unsigned char volatile xdata *)0xff55)
 538      =3  #define PWM6T1      (*(unsigned int  volatile xdata *)0xff60)
 539      =3  #define PWM6T1H     (*(unsigned char volatile xdata *)0xff60)
 540      =3  #define PWM6T1L     (*(unsigned char volatile xdata *)0xff61)
 541      =3  #define PWM6T2      (*(unsigned int  volatile xdata *)0xff62)
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 10  

 542      =3  #define PWM6T2H     (*(unsigned char volatile xdata *)0xff62)
 543      =3  #define PWM6T2L     (*(unsigned char volatile xdata *)0xff63)
 544      =3  #define PWM6CR      (*(unsigned char volatile xdata *)0xff64)
 545      =3  #define PWM6HLD     (*(unsigned char volatile xdata *)0xff65)
 546      =3  #define PWM7T1      (*(unsigned int  volatile xdata *)0xff70)
 547      =3  #define PWM7T1H     (*(unsigned char volatile xdata *)0xff70)
 548      =3  #define PWM7T1L     (*(unsigned char volatile xdata *)0xff71)
 549      =3  #define PWM7T2      (*(unsigned int  volatile xdata *)0xff72)
 550      =3  #define PWM7T2H     (*(unsigned char volatile xdata *)0xff72)
 551      =3  #define PWM7T2L     (*(unsigned char volatile xdata *)0xff73)
 552      =3  #define PWM7CR      (*(unsigned char volatile xdata *)0xff74)
 553      =3  #define PWM7HLD     (*(unsigned char volatile xdata *)0xff75)
 554      =3  
 555      =3  //I2C特殊功能寄存器
 556      =3  //如下特殊功能寄存器位于扩展RAM区域
 557      =3  //访问这些寄存器,需先将P_SW2的BIT7设置为1,才可正常读写
 558      =3  #define I2CCFG      (*(unsigned char volatile xdata *)0xfe80)
 559      =3  #define ENI2C       0x80
 560      =3  #define MSSL        0x40
 561      =3  #define I2CMSCR     (*(unsigned char volatile xdata *)0xfe81)
 562      =3  #define EMSI        0x80
 563      =3  #define I2CMSST     (*(unsigned char volatile xdata *)0xfe82)
 564      =3  #define MSBUSY      0x80
 565      =3  #define MSIF        0x40
 566      =3  #define MSACKI      0x02
 567      =3  #define MSACKO      0x01
 568      =3  #define I2CSLCR     (*(unsigned char volatile xdata *)0xfe83)
 569      =3  #define ESTAI       0x40
 570      =3  #define ERXI        0x20
 571      =3  #define ETXI        0x10
 572      =3  #define ESTOI       0x08
 573      =3  #define SLRST       0x01
 574      =3  #define I2CSLST     (*(unsigned char volatile xdata *)0xfe84)
 575      =3  #define SLBUSY      0x80
 576      =3  #define STAIF       0x40
 577      =3  #define RXIF        0x20
 578      =3  #define TXIF        0x10
 579      =3  #define STOIF       0x08
 580      =3  #define TXING       0x04
 581      =3  #define SLACKI      0x02
 582      =3  #define SLACKO      0x01
 583      =3  #define I2CSLADR    (*(unsigned char volatile xdata *)0xfe85)
 584      =3  #define I2CTXD      (*(unsigned char volatile xdata *)0xfe86)
 585      =3  #define I2CRXD      (*(unsigned char volatile xdata *)0xfe87)
 586      =3  
 587      =3  /////////////////////////////////////////////////
 588      =3  
 589      =3  #endif
 590      =3  
   5      =2  #include <stdio.h>
   1      =3  /*--------------------------------------------------------------------------
   2      =3  STDIO.H
   3      =3  
   4      =3  Prototypes for standard I/O functions.
   5      =3  Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
   6      =3  All rights reserved.
   7      =3  --------------------------------------------------------------------------*/
   8      =3  
   9      =3  #ifndef __STDIO_H__
  10      =3  #define __STDIO_H__
  11      =3  
  12      =3  #ifndef EOF
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 11  

  13      =3   #define EOF -1
  14      =3  #endif
  15      =3  
  16      =3  #ifndef NULL
  17      =3   #define NULL ((void *) 0)
  18      =3  #endif
  19      =3  
  20      =3  #ifndef _SIZE_T
  21      =3   #define _SIZE_T
  22      =3   typedef unsigned int size_t;
  23      =3  #endif
  24      =3  
  25      =3  #pragma SAVE
  26      =3  #pragma REGPARMS
  27      =3  extern char _getkey (void);
  28      =3  extern char getchar (void);
  29      =3  extern char ungetchar (char);
  30      =3  extern char putchar (char);
  31      =3  extern int printf   (const char *, ...);
  32      =3  extern int sprintf  (char *, const char *, ...);
  33      =3  extern int vprintf  (const char *, char *);
  34      =3  extern int vsprintf (char *, const char *, char *);
  35      =3  extern char *gets (char *, int n);
  36      =3  extern int scanf (const char *, ...);
  37      =3  extern int sscanf (char *, const char *, ...);
  38      =3  extern int puts (const char *);
  39      =3  
  40      =3  #pragma RESTORE
  41      =3  
  42      =3  #endif
  43      =3  
   6      =2  #include <intrins.h>
   1      =3  /*--------------------------------------------------------------------------
   2      =3  INTRINS.H
   3      =3  
   4      =3  Intrinsic functions for C51.
   5      =3  Copyright (c) 1988-2010 Keil Elektronik GmbH and ARM Germany GmbH
   6      =3  All rights reserved.
   7      =3  --------------------------------------------------------------------------*/
   8      =3  
   9      =3  #ifndef __INTRINS_H__
  10      =3  #define __INTRINS_H__
  11      =3  
  12      =3  #pragma SAVE
  13      =3  
  14      =3  #if defined (__CX2__)
           =3 #pragma FUNCTIONS(STATIC)
           =3 /* intrinsic functions are reentrant, but need static attribute */
           =3 #endif
  18      =3  
  19      =3  extern void          _nop_     (void);
  20      =3  extern bit           _testbit_ (bit);
  21      =3  extern unsigned char _cror_    (unsigned char, unsigned char);
  22      =3  extern unsigned int  _iror_    (unsigned int,  unsigned char);
  23      =3  extern unsigned long _lror_    (unsigned long, unsigned char);
  24      =3  extern unsigned char _crol_    (unsigned char, unsigned char);
  25      =3  extern unsigned int  _irol_    (unsigned int,  unsigned char);
  26      =3  extern unsigned long _lrol_    (unsigned long, unsigned char);
  27      =3  extern unsigned char _chkfloat_(float);
  28      =3  #if defined (__CX2__)
           =3 extern int           abs       (int);
           =3 extern void          _illop_   (void);
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 12  

           =3 #endif
  32      =3  #if !defined (__CX2__)
  33      =3  extern void          _push_    (unsigned char _sfr);
  34      =3  extern void          _pop_     (unsigned char _sfr);
  35      =3  #endif
  36      =3  
  37      =3  #pragma RESTORE
  38      =3  
  39      =3  #endif
  40      =3  
   7      =2  #include <string.h>
   1      =3  /*--------------------------------------------------------------------------
   2      =3  STRING.H
   3      =3  
   4      =3  String functions.
   5      =3  Copyright (c) 1988-2008 Keil Elektronik GmbH and Keil Software, Inc.
   6      =3  Copyright (c) 2008-2016 ARM Germany GmbH
   7      =3  All rights reserved.
   8      =3  --------------------------------------------------------------------------*/
   9      =3  
  10      =3  #ifndef __STRING_H__
  11      =3  #define __STRING_H__
  12      =3  
  13      =3  #ifndef _SIZE_T
           =3  #define _SIZE_T
           =3  typedef unsigned int size_t;
           =3 #endif
  17      =3  
  18      =3  #ifndef NULL
           =3  #define NULL ((void *)0)
           =3 #endif
  21      =3  
  22      =3  #pragma SAVE
  23      =3  #pragma REGPARMS
  24      =3  extern char  *strcat  (char *s1, const char *s2);
  25      =3  extern char  *strncat (char *s1, const char *s2, size_t n);
  26      =3  
  27      =3  extern char   strcmp  (const char *s1, const char *s2);
  28      =3  extern char   strncmp (const char *s1, const char *s2, size_t n);
  29      =3  
  30      =3  extern char  *strcpy  (char *s1, const char *s2);
  31      =3  extern char  *strncpy (char *s1, const char *s2, size_t n);
  32      =3  
  33      =3  extern size_t strlen  (const char *);
  34      =3  
  35      =3  extern char  *strchr  (const char *s, char c);
  36      =3  extern int    strpos  (const char *s, char c);
  37      =3  extern char  *strrchr (const char *s, char c);
  38      =3  extern int    strrpos (const char *s, char c);
  39      =3  
  40      =3  extern size_t strspn  (const char *s, const char *set);
  41      =3  extern size_t strcspn (const char *s, const char *set);
  42      =3  extern char  *strpbrk (const char *s, const char *set);
  43      =3  extern char  *strrpbrk(const char *s, const char *set);
  44      =3  extern char  *strstr  (const char *s, const char *sub);
  45      =3  extern char  *strtok  (char *str, const char *set);
  46      =3  
  47      =3  extern char   memcmp  (const void *s1, const void *s2, size_t n);
  48      =3  extern void  *memcpy  (void *s1, const void *s2, size_t n);
  49      =3  extern void  *memchr  (const void *s, char val, size_t n);
  50      =3  extern void  *memccpy (void *s1, const void *s2, char val, size_t n);
  51      =3  extern void  *memmove (void *s1, const void *s2, size_t n);
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 13  

  52      =3  extern void  *memset  (void *s, char val, size_t n);
  53      =3  #pragma RESTORE
  54      =3  
  55      =3  #endif
   8      =2  #include <stdlib.h>
   1      =3  /*--------------------------------------------------------------------------
   2      =3  STDLIB.H
   3      =3  
   4      =3  Standard functions.
   5      =3  Copyright (c) 1988-2008 Keil Elektronik GmbH and Keil Software, Inc.
   6      =3  Copyright (c) 2008-2016 ARM Germany GmbH
   7      =3  All rights reserved.
   8      =3  --------------------------------------------------------------------------*/
   9      =3  
  10      =3  #ifndef __STDLIB_H__
  11      =3  #define __STDLIB_H__
  12      =3  
  13      =3  #ifndef _SIZE_T
           =3  #define _SIZE_T
           =3  typedef unsigned int size_t;
           =3 #endif
  17      =3  
  18      =3  #ifndef NULL
           =3  #define NULL ((void *)0)
           =3 #endif
  21      =3  
  22      =3  #ifndef _WCHAR_T_DEFINED_
  23      =3  #define _WCHAR_T_DEFINED_
  24      =3  typedef char wchar_t;
  25      =3  #endif
  26      =3  
  27      =3  #if defined (__CX2__)
           =3 #ifndef _DIV_T_DEFINED
           =3 typedef struct _div_t {
           =3         int quot;
           =3         int rem;
           =3 } div_t;
           =3 typedef struct _ldiv_t {
           =3         long quot;
           =3         long rem;
           =3 } ldiv_t;
           =3 #define _DIV_T_DEFINED
           =3 #endif // _DIV_T_DEFINED
           =3 #endif // __CX2__
  40      =3  
  41      =3  #ifndef RAND_MAX
  42      =3   #define RAND_MAX  32767u
  43      =3  #endif
  44      =3  
  45      =3  #if defined (__CX2__)
           =3 #pragma SAVE
           =3 #pragma FUNCTIONS(STATIC)
           =3 /* intrinsic functions are reentrant, but need static attribute */
           =3 extern int    abs  (int   val);
           =3 #pragma RESTORE
           =3 #endif // __CX2__
  52      =3  
  53      =3  #pragma SAVE
  54      =3  #pragma REGPARMS
  55      =3  
  56      =3  extern char   cabs (char  val);
  57      =3  #if !defined (__CX2__)
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 14  

  58      =3  extern int    abs  (int   val);
  59      =3  #endif // __CX2__
  60      =3  extern long   labs (long  val);
  61      =3  
  62      =3  extern float  atof (const char *s1);
  63      =3  extern long   atol (const char *s1);
  64      =3  extern int    atoi (const char *s1);
  65      =3  extern int    rand (void);
  66      =3  extern void   srand (unsigned int seed);
  67      =3  
  68      =3  #ifdef _DIV_T_DEFINED
           =3 extern div_t  __div (int numer, int denom);
           =3 #define div(numer,denom)  __div((numer),(denom));
           =3 extern ldiv_t ldiv (long numer, long denom);
           =3 #endif // _DIV_T_DEFINED
  73      =3  
  74      =3  extern float         strtod  (const char *nptr, char **endptr);
  75      =3  extern long          strtol  (const char *nptr, char **endptr, unsigned char base);
  76      =3  extern unsigned long strtoul (const char *nptr, char **endptr, unsigned char base);
  77      =3  
  78      =3  #define _MALLOC_MEM_    xdata
  79      =3  
  80      =3  extern void init_mempool          (void _MALLOC_MEM_ *p, size_t size);
  81      =3  extern void _MALLOC_MEM_ *malloc  (size_t size);
  82      =3  extern void free                  (void _MALLOC_MEM_ *p);
  83      =3  extern void _MALLOC_MEM_ *realloc (void _MALLOC_MEM_ *p, size_t size);
  84      =3  extern void _MALLOC_MEM_ *calloc  (size_t nmemb, size_t size);
  85      =3  
  86      =3  #if defined (__CX2__)
           =3 extern void abort(void);
           =3 #endif // __CX2__
  89      =3  
  90      =3  #pragma RESTORE
  91      =3  
  92      =3  #endif // __STDLIB_H__
   9      =2  #include <string.h>
   1      =3  /*--------------------------------------------------------------------------
   2      =3  STRING.H
   3      =3  
   4      =3  String functions.
   5      =3  Copyright (c) 1988-2008 Keil Elektronik GmbH and Keil Software, Inc.
   6      =3  Copyright (c) 2008-2016 ARM Germany GmbH
   7      =3  All rights reserved.
   8      =3  --------------------------------------------------------------------------*/
   9      =3  
  10      =3  #ifndef __STRING_H__
           =3 #define __STRING_H__
           =3 
           =3 #ifndef _SIZE_T
           =3  #define _SIZE_T
           =3  typedef unsigned int size_t;
           =3 #endif
           =3 
           =3 #ifndef NULL
           =3  #define NULL ((void *)0)
           =3 #endif
           =3 
           =3 #pragma SAVE
           =3 #pragma REGPARMS
           =3 extern char  *strcat  (char *s1, const char *s2);
           =3 extern char  *strncat (char *s1, const char *s2, size_t n);
           =3 
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 15  

           =3 extern char   strcmp  (const char *s1, const char *s2);
           =3 extern char   strncmp (const char *s1, const char *s2, size_t n);
           =3 
           =3 extern char  *strcpy  (char *s1, const char *s2);
           =3 extern char  *strncpy (char *s1, const char *s2, size_t n);
           =3 
           =3 extern size_t strlen  (const char *);
           =3 
           =3 extern char  *strchr  (const char *s, char c);
           =3 extern int    strpos  (const char *s, char c);
           =3 extern char  *strrchr (const char *s, char c);
           =3 extern int    strrpos (const char *s, char c);
           =3 
           =3 extern size_t strspn  (const char *s, const char *set);
           =3 extern size_t strcspn (const char *s, const char *set);
           =3 extern char  *strpbrk (const char *s, const char *set);
           =3 extern char  *strrpbrk(const char *s, const char *set);
           =3 extern char  *strstr  (const char *s, const char *sub);
           =3 extern char  *strtok  (char *str, const char *set);
           =3 
           =3 extern char   memcmp  (const void *s1, const void *s2, size_t n);
           =3 extern void  *memcpy  (void *s1, const void *s2, size_t n);
           =3 extern void  *memchr  (const void *s, char val, size_t n);
           =3 extern void  *memccpy (void *s1, const void *s2, char val, size_t n);
           =3 extern void  *memmove (void *s1, const void *s2, size_t n);
           =3 extern void  *memset  (void *s, char val, size_t n);
           =3 #pragma RESTORE
           =3 
           =3 #endif
  10      =2  #include <absacc.h> //可直接操作内存地址
   1      =3  /*--------------------------------------------------------------------------
   2      =3  ABSACC.H
   3      =3  
   4      =3  Direct access to 8051, extended 8051 and NXP 8051MX memory areas.
   5      =3  Copyright (c) 1988-2010 Keil Elektronik GmbH and ARM Germany GmbH
   6      =3  All rights reserved.
   7      =3  --------------------------------------------------------------------------*/
   8      =3  
   9      =3  #ifndef __ABSACC_H__
  10      =3  #define __ABSACC_H__
  11      =3  
  12      =3  #define CBYTE ((unsigned char volatile code  *) 0)
  13      =3  #define DBYTE ((unsigned char volatile data  *) 0)
  14      =3  #if !defined (__CX2__)
  15      =3  #define PBYTE ((unsigned char volatile pdata *) 0)
  16      =3  #endif
  17      =3  #define XBYTE ((unsigned char volatile xdata *) 0)
  18      =3  
  19      =3  #define CWORD ((unsigned int volatile code  *) 0)
  20      =3  #define DWORD ((unsigned int volatile data  *) 0)
  21      =3  #if !defined (__CX2__)
  22      =3  #define PWORD ((unsigned int volatile pdata *) 0)
  23      =3  #endif
  24      =3  #define XWORD ((unsigned int volatile xdata *) 0)
  25      =3  
  26      =3  
  27      =3  #if defined (__CX51__) || defined (__CX2__)
           =3 #define FVAR(object, addr)   (*((object volatile far *) (addr)))
           =3 #define FARRAY(object, base) ((object volatile far *) (base))
           =3 #define FCVAR(object, addr)   (*((object const far *) (addr)))
           =3 #define FCARRAY(object, base) ((object const far *) (base))
           =3 #else
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 16  

  33      =3  #define FVAR(object, addr)    (*((object volatile far *) ((addr)+0x10000L)))
  34      =3  #define FCVAR(object, addr)   (*((object const far *) ((addr)+0x810000L)))
  35      =3  #define FARRAY(object, base)  ((object volatile far *) ((base)+0x10000L))
  36      =3  #define FCARRAY(object, base) ((object const far *) ((base)+0x810000L))
  37      =3  #endif
  38      =3  
  39      =3  #if defined (__CX2__)
           =3 #define HBYTE ((unsigned char volatile huge *)  0)
           =3 #define HWORD ((unsigned int volatile huge *)  0)
           =3 #define HVAR(object, addr)   (*((object volatile huge *) (addr)))
           =3 #define HARRAY(object, base) ((object volatile huge *) (base))
           =3 #endif
  45      =3  
  46      =3  #define CVAR(object, addr)   (*((object volatile code *) (addr)))
  47      =3  #define CARRAY(object, base) ((object volatile code *) (base))
  48      =3  #define DVAR(object, addr)   (*((object volatile data *) (addr)))
  49      =3  #define DARRAY(object, base) ((object volatile data *) (base))
  50      =3  #define XVAR(object, addr)   (*((object volatile xdata *) (addr)))
  51      =3  #define XARRAY(object, base) ((object volatile xdata *) (base))
  52      =3  
  53      =3  #endif
  11      =2  #include <stdarg.h>
   1      =3  /*--------------------------------------------------------------------------
   2      =3  STDARG.H
   3      =3  
   4      =3  Prototypes for variable argument lists.
   5      =3  Copyright (c) 1988-2008 Keil Elektronik GmbH and Keil Software, Inc.
   6      =3  Copyright (c) 2008-2016 ARM Germany GmbH
   7      =3  All rights reserved.
   8      =3  --------------------------------------------------------------------------*/
   9      =3  
  10      =3  #ifndef __STDARG_H__
  11      =3  #define __STDARG_H__
  12      =3  
  13      =3  #ifndef __CX2__
  14      =3  #ifndef NULL
           =3  #define NULL ((void *)0)
           =3 #endif
  17      =3  #endif
  18      =3  
  19      =3  #ifndef _VA_LIST_DEFINED
  20      =3  typedef char *va_list;
  21      =3  #define _VA_LIST_DEFINED
  22      =3  #endif
  23      =3  
  24      =3  #if defined __CX2__ && __CX2__ >= 558
           =3   #define va_start(ap,v) ap = _va_start_ (&v, sizeof(v))
           =3   extern void *_va_start_ (void *ap, int sz);   // intrinsic
           =3 #else
  28      =3    #define va_start(ap,v) ap = (va_list)&v + sizeof(v)
  29      =3  #endif
  30      =3  
  31      =3  #define va_arg(ap,t) (((t *)ap)++[0])
  32      =3  #define va_end(ap)   (ap = (va_list)0)
  33      =3  
  34      =3  #endif
  12      =2  
  13      =2  
  14      =2  /**********************布尔变量定义**********************/
  15      =2  #define true  1
  16      =2  #define false 0
  17      =2  /**********************布尔变量定义**********************/
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 17  

  18      =2  
  19      =2  /***********************************API配置接口***********************************/
  20      =2  /*使用外部晶振*/
  21      =2  #define EXTERNAL_CRYSTAL 0 
  22      =2  /*调试是否启用串口*/
  23      =2  #define USE_PRINTF_DEBUG 0 
  24      =2  /*调试选项*/
  25      =2  #define DEBUGGING    0
  26      =2  /*迪文屏幕使用CRC校验*/
  27      =2  #define USING_CRC 1
  28      =2  /*定义WIFI模块相关引脚*/
  29      =2  #define WIFI_RESET              P23
  30      =2  #define WIFI_RELOAD             P20
  31      =2  
  32      =2  #define COUNTMAX     65536U
  33      =2  
  34      =2  /*消除编译器未使用变量警告*/
  35      =2  #define UNUSED_VARIABLE(x)      ((void)(x))
  36      =2  #define UNUSED_PARAMETER(x) UNUSED_VARIABLE(x)
  37      =2  
  38      =2  //(1/FOSC)*count =times(us)->count = time*FOSC/1000(ms)
  39      =2  #define FOSC         27000000UL//11059200UL
  40      =2  /*1ms(时钟频率越高，所能产生的时间越小)*/  
  41      =2  #define TIMES        10U  
  42      =2  /*定时器模式选择*/
  43      =2  #define TIMER_MODE   12U
  44      =2  /*定时器分频系数，默认为一分频*/  
  45      =2  #define TIME_DIV     1U  
  46      =2  #define T12_MODE (TIMES * FOSC / 1000 / 12 / TIME_DIV) 
  47      =2  #define T1_MODE  (TIMES * FOSC/ 1000 / TIME_DIV)
  48      =2  #define TIMERS_OVERFLOW (COUNTMAX * 1000 * TIMER_MODE * TIME_DIV) / FOSC
  49      =2  
  50      =2  #define OPEN_GLOBAL_OUTAGE()  (EA = 1 << 0)
  51      =2  #define CLOSE_GLOBAL_OUTAGE() (EA = 0 << 0)
  52      =2  /*判断延时数是否超出硬件允许范围*/
  53      =2  #if(TIMES > TIMERS_OVERFLOW)
           =2 #error The timer cannot generate the current duration!
           =2 #endif
  56      =2  /***********************************API配置接口***********************************/
  57      =2  
  58      =2  /***********************************常用的数据类型***********************************/
  59      =2  typedef unsigned char  uint8_t;
  60      =2  typedef signed char    int8_t;
  61      =2  typedef unsigned short int  uint16_t;
  62      =2  typedef unsigned long  uint32_t;
  63      =2  typedef signed long    int32_t;
  64      =2  typedef volatile       __IO;   
  65      =2  
  66      =2  /***********************************常用的数据类型***********************************/
  67      =2  
  68      =2  /***********************************系统上电参数***********************************/
  69      =2  #define DEFAULT_SYSTEM_PARAMETER  "\xFF\xFF\xFF\xFF\x02\x01\x00\x84\x50"
  70      =2  
  71      =2  /***********************************系统上电参数***********************************/
  72      =2  
  73      =2  /***********************************结构体的妙用 ***********************************/
  74      =2  /*获得结构体(TYPE)的变量成员(MEMBER)在此结构体中的偏移量*/ 
  75      =2  #define offsetof(TYPE, MEMBER) ((size_t) &((TYPE *)0)->MEMBER)
  76      =2  /*根据"结构体(type)变量"中的"域成员变量(member)的指针(ptr)"来获取指向整个结构体
             -变量的指针*/ 
  77      =2  #define container_of(ptr, type, member) ({ \
  78      =2          const typeof( ((type *)0)->member ) *__mptr = (ptr); \
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 18  

  79      =2          (type *)( (char *)__mptr - offsetof(type,member) );}) 
  80      =2  /***********************************结构体的妙用 ***********************************/
  81      =2  
  82      =2  
  83      =2  extern const uint8_t g_TimerNumbers;
  84      =2  /***********************************函数声明***********************************/
  85      =2  void  Gpio_Init(void);
  86      =2  /***********************************函数声明***********************************/
  87      =2  #endif
   5      =1  
   6      =1  #define GPIO_PullUp             0       //上拉准双向口
   7      =1  #define GPIO_HighZ              1       //浮空输入
   8      =1  #define GPIO_OUT_OD             2       //开漏输出
   9      =1  #define GPIO_OUT_PP             3       //推挽输出
  10      =1  
  11      =1  #define GPIO_Pin_0              0x01    //IO引脚 Px.0
  12      =1  #define GPIO_Pin_1              0x02    //IO引脚 Px.1
  13      =1  #define GPIO_Pin_2              0x04    //IO引脚 Px.2
  14      =1  #define GPIO_Pin_3              0x08    //IO引脚 Px.3
  15      =1  #define GPIO_Pin_4              0x10    //IO引脚 Px.4
  16      =1  #define GPIO_Pin_5              0x20    //IO引脚 Px.5
  17      =1  #define GPIO_Pin_6              0x40    //IO引脚 Px.6
  18      =1  #define GPIO_Pin_7              0x80    //IO引脚 Px.7
  19      =1  #define GPIO_Pin_All    0xFF    //IO所有引脚
  20      =1          
  21      =1  #define GPIO_P0                 0               //
  22      =1  #define GPIO_P1                 1
  23      =1  #define GPIO_P2                 2
  24      =1  #define GPIO_P3                 3
  25      =1  #define GPIO_P4                 4
  26      =1  #define GPIO_P5                 5
  27      =1  
  28      =1  typedef struct
  29      =1  {
  30      =1          uint8_t Mode;           //IO模式,             GPIO_PullUp,GPIO_HighZ,GPIO_OUT_OD,GPIO_OUT_PP
  31      =1          uint8_t Pin;            //要设置的端口    
  32      =1  }GPIO_InitTypeDef;
  33      =1  
  34      =1  uint8_t GPIO_Inilize(uint8_t GPIO, GPIO_InitTypeDef *GPIOx);
  35      =1  
  36      =1  #endif
   2          #include "timer.h"
   1      =1  #ifndef __TIMER_H_
   2      =1  #define __TIMER_H_
   3      =1  /*
   4      =1          data：固定指前面0x00-0x7F的128个RAM，可以用acc直接读写，速度最快，生成的代码
             -最小。
   5      =1          idata：固定指前面0x00-0xFF的256个RAM，其中前128和data的128完全相同，只是访问的方
             -式不同。
   6      =1          xdata：外部扩展RAM。
   7      =1          code：ROM。
   8      =1  */
   9      =1  #include "STC_NVIC.h"
   1      =2  #ifndef __STC_NVIC_H_
   2      =2  #define __STC_NVIC_H_
   3      =2  #include "config.h"
   1      =3  #ifndef __CONFIG_H_
           =3 #define __CONFIG_H_
           =3 
           =3 #include <STC8.H>
           =3 #include <stdio.h>
           =3 #include <intrins.h>
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 19  

           =3 #include <string.h>
           =3 #include <stdlib.h>
           =3 #include <string.h>
           =3 #include <absacc.h> //可直接操作内存地址
           =3 #include <stdarg.h>
           =3 
           =3 
           =3 /**********************布尔变量定义**********************/
           =3 #define true  1
           =3 #define false 0
           =3 /**********************布尔变量定义**********************/
           =3 
           =3 /***********************************API配置接口***********************************/
           =3 /*使用外部晶振*/
           =3 #define EXTERNAL_CRYSTAL 0 
           =3 /*调试是否启用串口*/
           =3 #define USE_PRINTF_DEBUG 0 
           =3 /*调试选项*/
           =3 #define DEBUGGING    0
           =3 /*迪文屏幕使用CRC校验*/
           =3 #define USING_CRC 1
           =3 /*定义WIFI模块相关引脚*/
           =3 #define WIFI_RESET              P23
           =3 #define WIFI_RELOAD             P20
           =3 
           =3 #define COUNTMAX     65536U
           =3 
           =3 /*消除编译器未使用变量警告*/
           =3 #define UNUSED_VARIABLE(x)      ((void)(x))
           =3 #define UNUSED_PARAMETER(x) UNUSED_VARIABLE(x)
           =3 
           =3 //(1/FOSC)*count =times(us)->count = time*FOSC/1000(ms)
           =3 #define FOSC         27000000UL//11059200UL
           =3 /*1ms(时钟频率越高，所能产生的时间越小)*/  
           =3 #define TIMES        10U  
           =3 /*定时器模式选择*/
           =3 #define TIMER_MODE   12U
           =3 /*定时器分频系数，默认为一分频*/  
           =3 #define TIME_DIV     1U  
           =3 #define T12_MODE (TIMES * FOSC / 1000 / 12 / TIME_DIV) 
           =3 #define T1_MODE  (TIMES * FOSC/ 1000 / TIME_DIV)
           =3 #define TIMERS_OVERFLOW (COUNTMAX * 1000 * TIMER_MODE * TIME_DIV) / FOSC
           =3 
           =3 #define OPEN_GLOBAL_OUTAGE()  (EA = 1 << 0)
           =3 #define CLOSE_GLOBAL_OUTAGE() (EA = 0 << 0)
           =3 /*判断延时数是否超出硬件允许范围*/
           =3 #if(TIMES > TIMERS_OVERFLOW)
           =3 #error The timer cannot generate the current duration!
           =3 #endif
           =3 /***********************************API配置接口***********************************/
           =3 
           =3 /***********************************常用的数据类型***********************************/
           =3 typedef unsigned char  uint8_t;
           =3 typedef signed char    int8_t;
           =3 typedef unsigned short int  uint16_t;
           =3 typedef unsigned long  uint32_t;
           =3 typedef signed long    int32_t;
           =3 typedef volatile       __IO;   
           =3 
           =3 /***********************************常用的数据类型***********************************/
           =3 
           =3 /***********************************系统上电参数***********************************/
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 20  

           =3 #define DEFAULT_SYSTEM_PARAMETER  "\xFF\xFF\xFF\xFF\x02\x01\x00\x84\x50"
           =3 
           =3 /***********************************系统上电参数***********************************/
           =3 
           =3 /***********************************结构体的妙用 ***********************************/
           =3 /*获得结构体(TYPE)的变量成员(MEMBER)在此结构体中的偏移量*/ 
           =3 #define offsetof(TYPE, MEMBER) ((size_t) &((TYPE *)0)->MEMBER)
           =3 /*根据"结构体(type)变量"中的"域成员变量(member)的指针(ptr)"来获取指向整个结构体
             -变量的指针*/ 
           =3 #define container_of(ptr, type, member) ({ \
           =3         const typeof( ((type *)0)->member ) *__mptr = (ptr); \
           =3         (type *)( (char *)__mptr - offsetof(type,member) );}) 
           =3 /***********************************结构体的妙用 ***********************************/
           =3 
           =3 
           =3 extern const uint8_t g_TimerNumbers;
           =3 /***********************************函数声明***********************************/
           =3 void  Gpio_Init(void);
           =3 /***********************************函数声明***********************************/
           =3 #endif
   4      =2  
   5      =2  /*中断使能寄存器*/
   6      =2  typedef struct 
   7      =2  {
   8      =2      union 
   9      =2      {
  10      =2          struct 
  11      =2          {
  12      =2              uint8_t bEA : 1;
  13      =2              uint8_t bELVD : 1;
  14      =2              uint8_t bEADC : 1;
  15      =2              uint8_t bES  : 1;
  16      =2              uint8_t bET1 : 1;
  17      =2              uint8_t bEX1 : 1;
  18      =2              uint8_t bET0 : 1;
  19      =2              uint8_t bEX0 : 1;
  20      =2          }IE_Bit;
  21      =2          uint8_t IE_U8;  
  22      =2      }IE;
  23      =2  }IE_Register;
  24      =2  
  25      =2  /*中断使能寄存器2*/
  26      =2  typedef struct 
  27      =2  {
  28      =2      union 
  29      =2      {
  30      =2          struct 
  31      =2          {
  32      =2              uint8_t bECAN : 1;
  33      =2              uint8_t bET4  : 1;
  34      =2              uint8_t bET3  : 1;
  35      =2              uint8_t bES4  : 1;
  36      =2              uint8_t bES3  : 1;
  37      =2              uint8_t bET2  : 1;
  38      =2              uint8_t bESP1 : 1;
  39      =2              uint8_t bES2  : 1;
  40      =2          }IE2_Bit;
  41      =2          uint8_t IE2_U8;  
  42      =2      }IE2;
  43      =2  }IE2_Register;
  44      =2  
  45      =2  /*中断请求寄存器*/
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 21  

  46      =2  /*定时器1/0模式控制寄存器*/
  47      =2  typedef struct 
  48      =2  {
  49      =2          union 
  50      =2          {
  51      =2                  struct 
  52      =2                  {
  53      =2                          uint8_t bTF1 : 1;
  54      =2                          uint8_t bTR1 : 1;
  55      =2                          uint8_t bTF0 : 1;
  56      =2                          uint8_t bTR0 : 1;
  57      =2                          uint8_t bIE1 : 1;
  58      =2                          uint8_t bIT1 : 1;
  59      =2                          uint8_t bIE0 : 1;
  60      =2                          uint8_t bIT0 : 1;       
  61      =2                  }TCON_Bit;
  62      =2                  uint8_t TCON_U8;
  63      =2          }TCON;
  64      =2  }TCON_Register;
  65      =2  
  66      =2  /*中断标志辅助寄存器*/
  67      =2  typedef struct 
  68      =2  {
  69      =2          union 
  70      =2          {
  71      =2                  struct 
  72      =2                  {
  73      =2                          uint8_t bNULL0  : 1;
  74      =2                          uint8_t bINT4IF : 1;
  75      =2                          uint8_t bINT3IF : 1;
  76      =2                          uint8_t bINT2IF : 1;
  77      =2                          uint8_t bNULL1  : 1;
  78      =2                          uint8_t bT4IF   : 1;
  79      =2                          uint8_t bT3IF   : 1;
  80      =2                          uint8_t bT2IF   : 1;
  81      =2                  }AUXRINTIF_Bit;
  82      =2                  uint8_t AUXRINTIF_U8;   
  83      =2          }AUXRINTIF;     
  84      =2  }AUXRINTIF_Register;
  85      =2  
  86      =2  /*外部中断与时钟输出寄存器*/
  87      =2  typedef struct 
  88      =2  {
  89      =2          union 
  90      =2          {
  91      =2                  struct 
  92      =2                  {
  93      =2                          uint8_t bNULL0 : 1;
  94      =2                          uint8_t bEX4 : 1;
  95      =2                          uint8_t bEX3 : 1;
  96      =2                          uint8_t bEX2 : 1;
  97      =2                          uint8_t bNULL1  : 1;
  98      =2                          uint8_t bT2CLKO : 1;
  99      =2                          uint8_t bT1CLKO : 1;
 100      =2                          uint8_t bT0CLKO : 1;
 101      =2                  }INITCLO_Bit;
 102      =2                  uint8_t INITCLO_U8;     
 103      =2          }INTCLKO;
 104      =2  }INTCLKO_Register;
 105      =2  
 106      =2  /*中断优先级寄存器*/
 107      =2  typedef struct 
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 22  

 108      =2  {
 109      =2          union 
 110      =2          {
 111      =2                  struct 
 112      =2                  {
 113      =2                          uint8_t bPPCA : 1;
 114      =2                          uint8_t bPLVD : 1;
 115      =2                          uint8_t bPADC : 1;
 116      =2                          uint8_t bPS   : 1;
 117      =2                          uint8_t bPT1  : 1;
 118      =2                          uint8_t bPX1  : 1;
 119      =2                          uint8_t bPT0  : 1;
 120      =2                          uint8_t bPX0  : 1;
 121      =2                  }IP_Bit;
 122      =2                  uint8_t IP_U8;  
 123      =2          }IP;
 124      =2  }IP_Register;
 125      =2  
 126      =2  /*中断优先级寄存器*/
 127      =2  typedef struct 
 128      =2  {
 129      =2          union 
 130      =2          {
 131      =2                  struct 
 132      =2                  {
 133      =2                          uint8_t bPPCAH : 1;
 134      =2                          uint8_t bPLVDH : 1;
 135      =2                          uint8_t bPADCH : 1;
 136      =2                          uint8_t bPSH   : 1;
 137      =2                          uint8_t bPT1H  : 1;
 138      =2                          uint8_t bPX1H  : 1;
 139      =2                          uint8_t bPT0H  : 1;
 140      =2                          uint8_t bPX0H  : 1;
 141      =2                  }IPH_Bit;
 142      =2                  uint8_t IPH_U8;         
 143      =2          }IPH;
 144      =2  }IPH_Register;
 145      =2  
 146      =2  /*中断优先级寄存器*/
 147      =2  typedef struct 
 148      =2  {
 149      =2          union 
 150      =2          {
 151      =2                  struct 
 152      =2                  {
 153      =2                          uint8_t bPCAN : 1;
 154      =2                          uint8_t bPI2C : 1;
 155      =2                          uint8_t bPCMP : 1;
 156      =2                          uint8_t bPX4  : 1;
 157      =2                          uint8_t bPPWMFD  : 1;
 158      =2                          uint8_t bPPWM : 1;
 159      =2                          uint8_t bPSPI : 1;
 160      =2                          uint8_t bPS2  : 1;
 161      =2                  }IP2_Bit;
 162      =2                  uint8_t IP2_U8;         
 163      =2          }IP2;
 164      =2  }IP2_Register;
 165      =2  
 166      =2  /*中断优先级寄存器*/
 167      =2  typedef struct 
 168      =2  {
 169      =2          union 
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 23  

 170      =2          {
 171      =2                  struct 
 172      =2                  {
 173      =2                          uint8_t bPCAN : 1;
 174      =2                          uint8_t bPI2C : 1;
 175      =2                          uint8_t bPCMP : 1;
 176      =2                          uint8_t bPX4  : 1;
 177      =2                          uint8_t bPPWMFD  : 1;
 178      =2                          uint8_t bPPWM : 1;
 179      =2                          uint8_t bPSPI : 1;
 180      =2                          uint8_t bPS2  : 1;
 181      =2                  }IP2H_Bit;
 182      =2                  uint8_t IP2H_U8;        
 183      =2          }IP2H;
 184      =2  }IP2H_Register;
 185      =2  
 186      =2  /*定时器中断优先级*/
 187      =2  typedef struct 
 188      =2  {
 189      =2          IPH_Register   IPH_Reg;
 190      =2      IP_Register    IP_Reg;
 191      =2  }TIMER_NVIC_TypeDef;
 192      =2  
 193      =2  
 194      =2  
 195      =2  
 196      =2  
 197      =2  
 198      =2  /*PCA/CCP/PWM*/
 199      =2  typedef struct 
 200      =2  {
 201      =2      union 
 202      =2      {
 203      =2          struct 
 204      =2          {
 205      =2              uint8_t bCIDL : 1;
 206      =2              uint8_t bNULL : 3;
 207      =2              uint8_t bCPS  : 3;
 208      =2              uint8_t bECF  : 1;
 209      =2          }CMOD_Bit;
 210      =2          uint8_t CMOD_U8;  
 211      =2      }CMOD;
 212      =2  }CMOD_Register;
 213      =2  
 214      =2  /*PCA/CCP/PWM*/
 215      =2  typedef struct 
 216      =2  {
 217      =2      union 
 218      =2      {
 219      =2          struct 
 220      =2          {
 221      =2              uint8_t bNULL   : 1;
 222      =2              uint8_t bECOM0  : 1;
 223      =2              uint8_t bCCAPP0 : 1;
 224      =2              uint8_t bCCAPN0 : 1;
 225      =2              uint8_t bMAT0   : 1;
 226      =2              uint8_t bTOG0   : 1;
 227      =2              uint8_t bPWM0   : 1;
 228      =2              uint8_t bECCF0  : 1;
 229      =2          }CCAPM0_Bit;
 230      =2          uint8_t CCAPM0_U8;  
 231      =2      }CCAPM0;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 24  

 232      =2  }CCAPM0_Register;
 233      =2  
 234      =2  /*PCA/CCP/PWM*/
 235      =2  typedef struct 
 236      =2  {
 237      =2      union 
 238      =2      {
 239      =2          struct 
 240      =2          {
 241      =2              uint8_t bNULL   : 1;
 242      =2              uint8_t bECOM1  : 1;
 243      =2              uint8_t bCCAPP1 : 1;
 244      =2              uint8_t bCCAPN1 : 1;
 245      =2              uint8_t bMAT1   : 1;
 246      =2              uint8_t bTOG1   : 1;
 247      =2              uint8_t bPWM1   : 1;
 248      =2              uint8_t bECCF1  : 1;
 249      =2          }CCAPM1_Bit;
 250      =2          uint8_t CCAPM1_U8;  
 251      =2      }CCAPM1;
 252      =2  }CCAPM1_Register;
 253      =2  
 254      =2  /*PCA/CCP/PWM*/
 255      =2  typedef struct 
 256      =2  {
 257      =2      union 
 258      =2      {
 259      =2          struct 
 260      =2          {
 261      =2              uint8_t bNULL   : 1;
 262      =2              uint8_t bECOM2  : 1;
 263      =2              uint8_t bCCAPP2 : 1;
 264      =2              uint8_t bCCAPN2 : 1;
 265      =2              uint8_t bMAT2   : 1;
 266      =2              uint8_t bTOG2   : 1;
 267      =2              uint8_t bPWM2   : 1;
 268      =2              uint8_t bECCF2  : 1;
 269      =2          }CCAPM2_Bit;
 270      =2          uint8_t CCAPM2_U8;  
 271      =2      }CCAPM2;
 272      =2  }CCAPM2_Register;
 273      =2  
 274      =2  /*PCA/CCP/PWM*/
 275      =2  typedef struct 
 276      =2  {
 277      =2      union 
 278      =2      {
 279      =2          struct 
 280      =2          {
 281      =2              uint8_t bNULL   : 1;
 282      =2              uint8_t bECOM3  : 1;
 283      =2              uint8_t bCCAPP3 : 1;
 284      =2              uint8_t bCCAPN3 : 1;
 285      =2              uint8_t bMAT3   : 1;
 286      =2              uint8_t bTOG3   : 1;
 287      =2              uint8_t bPWM3   : 1;
 288      =2              uint8_t bECCF3  : 1;
 289      =2          }CCAPM3_Bit;
 290      =2          uint8_t CCAPM3_U8;  
 291      =2      }CCAPM3;
 292      =2  }CCAPM3_Register;
 293      =2  
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 25  

 294      =2  /*比较器控制寄存器*/
 295      =2  typedef struct 
 296      =2  {
 297      =2      union 
 298      =2      {
 299      =2          struct 
 300      =2          {
 301      =2              uint8_t bCMPEN  : 1;
 302      =2              uint8_t bCMPIF  : 1;
 303      =2              uint8_t bPIE    : 1;
 304      =2              uint8_t bNIE    : 1;
 305      =2              uint8_t bPIS    : 1;
 306      =2              uint8_t bNIS    : 1;
 307      =2              uint8_t bCMPOE  : 1;
 308      =2              uint8_t bCMPRES : 1;
 309      =2          }CMPCR1_Bit;
 310      =2          uint8_t CMPCR1_U8;  
 311      =2      }CMPCR1;
 312      =2  }CMPCR1_Register;
 313      =2  
 314      =2  /*PWM控制寄存器*/
 315      =2  typedef struct 
 316      =2  {
 317      =2      union 
 318      =2      {
 319      =2          struct 
 320      =2          {
 321      =2              uint8_t bENPWM  : 1;
 322      =2              uint8_t bECBI   : 1;
 323      =2              uint8_t bNULL   : 6;
 324      =2          }PWMCR_Bit;
 325      =2          uint8_t PWMCR_U8;  
 326      =2      }PWMCR;
 327      =2  }PWMCR_Register;
 328      =2  
 329      =2  /*PWM异常检测控制寄存器*/
 330      =2  typedef struct 
 331      =2  {
 332      =2      union 
 333      =2      {
 334      =2          struct 
 335      =2          {
 336      =2              uint8_t bINVCMP  : 1;
 337      =2              uint8_t bINIO    : 1;
 338      =2              uint8_t bENFD    : 1;
 339      =2              uint8_t bFLTEFLO : 1;
 340      =2              uint8_t bEFDI    : 1;
 341      =2              uint8_t bFDCMP   : 1;
 342      =2              uint8_t bFDIO    : 1;
 343      =2              uint8_t bFDIF    : 1;
 344      =2          }PWMFDCR_Bit;
 345      =2          uint8_t PWMFDCR_U8;  
 346      =2      }PWMFDCR;
 347      =2  }PWMFDCR_Register;
 348      =2  
 349      =2  /*增强型PWM控制寄存器*/
 350      =2  typedef struct 
 351      =2  {
 352      =2      union 
 353      =2      {
 354      =2          struct 
 355      =2          {
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 26  

 356      =2              uint8_t bENC0O   : 1;
 357      =2              uint8_t bC0INI   : 1;
 358      =2              uint8_t bNULL    : 1;
 359      =2              uint8_t bC0_S    : 2;
 360      =2              uint8_t bEC0I    : 1;
 361      =2              uint8_t bEC0T2SI : 1;
 362      =2              uint8_t bEC0T1SI : 1;
 363      =2          }PWMM0CR_Bit;
 364      =2          uint8_t PWMM0CR_U8;  
 365      =2      }PWMM0CR;
 366      =2  }PWMM0CR_Register;
 367      =2  
 368      =2  /*增强型PWM控制寄存器*/
 369      =2  typedef struct 
 370      =2  {
 371      =2      union 
 372      =2      {
 373      =2          struct 
 374      =2          {
 375      =2              uint8_t bENC1O   : 1;
 376      =2              uint8_t bC1INI   : 1;
 377      =2              uint8_t bNULL    : 1;
 378      =2              uint8_t bC1_S    : 2;
 379      =2              uint8_t bEC1I    : 1;
 380      =2              uint8_t bEC1T2SI : 1;
 381      =2              uint8_t bEC1T1SI : 1;
 382      =2          }PWMM1CR_Bit;
 383      =2          uint8_t PWMM1CR_U8;  
 384      =2      }PWMM1CR;
 385      =2  }PWMM1CR_Register;
 386      =2  
 387      =2  /*增强型PWM控制寄存器*/
 388      =2  typedef struct 
 389      =2  {
 390      =2      union 
 391      =2      {
 392      =2          struct 
 393      =2          {
 394      =2              uint8_t bENC2O   : 1;
 395      =2              uint8_t bC2INI   : 1;
 396      =2              uint8_t bNULL    : 1;
 397      =2              uint8_t bC2_S    : 2;
 398      =2              uint8_t bEC2I    : 1;
 399      =2              uint8_t bEC2T2SI : 1;
 400      =2              uint8_t bEC2T1SI : 1;
 401      =2          }PWMM2CR_Bit;
 402      =2          uint8_t PWMM2CR_U8;  
 403      =2      }PWMM2CR;
 404      =2  }PWMM2CR_Register;
 405      =2  
 406      =2  /*增强型PWM控制寄存器*/
 407      =2  typedef struct 
 408      =2  {
 409      =2      union 
 410      =2      {
 411      =2          struct 
 412      =2          {
 413      =2              uint8_t bENC3O   : 1;
 414      =2              uint8_t bC3INI   : 1;
 415      =2              uint8_t bNULL    : 1;
 416      =2              uint8_t bC3_S    : 2;
 417      =2              uint8_t bEC3I    : 1;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 27  

 418      =2              uint8_t bEC3T2SI : 1;
 419      =2              uint8_t bEC3T1SI : 1;
 420      =2          }PWMM3CR_Bit;
 421      =2          uint8_t PWMM3CR_U8;  
 422      =2      }PWMM3CR;
 423      =2  }PWMM3CR_Register;
 424      =2  
 425      =2  /*增强型PWM控制寄存器*/
 426      =2  typedef struct 
 427      =2  {
 428      =2      union 
 429      =2      {
 430      =2          struct 
 431      =2          {
 432      =2              uint8_t bENC4O   : 1;
 433      =2              uint8_t bC4INI   : 1;
 434      =2              uint8_t bNULL    : 1;
 435      =2              uint8_t bC4_S    : 2;
 436      =2              uint8_t bEC4I    : 1;
 437      =2              uint8_t bEC4T2SI : 1;
 438      =2              uint8_t bEC4T1SI : 1;
 439      =2          }PWMM4CR_Bit;
 440      =2          uint8_t PWMM4CR_U8;  
 441      =2      }PWMM4CR;
 442      =2  }PWMM4CR_Register;
 443      =2  
 444      =2  /*增强型PWM控制寄存器*/
 445      =2  typedef struct 
 446      =2  {
 447      =2      union 
 448      =2      {
 449      =2          struct 
 450      =2          {
 451      =2              uint8_t bENC5O   : 1;
 452      =2              uint8_t bC5INI   : 1;
 453      =2              uint8_t bNULL    : 1;
 454      =2              uint8_t bC5_S    : 2;
 455      =2              uint8_t bEC5I    : 1;
 456      =2              uint8_t bEC5T2SI : 1;
 457      =2              uint8_t bEC5T1SI : 1;
 458      =2          }PWMM5CR_Bit;
 459      =2          uint8_t PWMM5CR_U8;  
 460      =2      }PWMM5CR;
 461      =2  }PWMM5CR_Register;
 462      =2  
 463      =2  /*增强型PWM控制寄存器*/
 464      =2  typedef struct 
 465      =2  {
 466      =2      union 
 467      =2      {
 468      =2          struct 
 469      =2          {
 470      =2              uint8_t bENC6O   : 1;
 471      =2              uint8_t bC6INI   : 1;
 472      =2              uint8_t bNULL    : 1;
 473      =2              uint8_t bC6_S    : 2;
 474      =2              uint8_t bEC6I    : 1;
 475      =2              uint8_t bEC6T2SI : 1;
 476      =2              uint8_t bEC6T1SI : 1;
 477      =2          }PWMM6CR_Bit;
 478      =2          uint8_t PWMM6CR_U8;  
 479      =2      }PWMM6CR;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 28  

 480      =2  }PWMM6CR_Register;
 481      =2  
 482      =2  /*增强型PWM控制寄存器*/
 483      =2  typedef struct 
 484      =2  {
 485      =2      union 
 486      =2      {
 487      =2          struct 
 488      =2          {
 489      =2              uint8_t bENC7O   : 1;
 490      =2              uint8_t bC7INI   : 1;
 491      =2              uint8_t bNULL    : 1;
 492      =2              uint8_t bC7_S    : 2;
 493      =2              uint8_t bEC7I    : 1;
 494      =2              uint8_t bEC7T2SI : 1;
 495      =2              uint8_t bEC7T1SI : 1;
 496      =2          }PWMM7CR_Bit;
 497      =2          uint8_t PWMM7CR_U8;  
 498      =2      }PWMM7CR;
 499      =2  }PWMM7CR_Register;
 500      =2  
 501      =2  /*IIC控制寄存器*/
 502      =2  typedef struct 
 503      =2  {
 504      =2      union 
 505      =2      {
 506      =2          struct 
 507      =2          {
 508      =2              uint8_t bEMSI   : 1;
 509      =2              uint8_t bNULL   : 4;
 510      =2              uint8_t bMSCMD  : 3;
 511      =2          }I2CMSCR_Bit;
 512      =2          uint8_t I2CMSCR_U8;  
 513      =2      }rI2CMSCR;
 514      =2  }I2CMSCR_Register;
 515      =2  
 516      =2  /*IIC控制寄存器*/
 517      =2  typedef struct 
 518      =2  {
 519      =2      union 
 520      =2      {
 521      =2          struct 
 522      =2          {
 523      =2              uint8_t bNULL0  : 1;
 524      =2              uint8_t bESTAI  : 1;
 525      =2              uint8_t bERXI   : 1;
 526      =2              uint8_t bETXI   : 1;
 527      =2              uint8_t bESTOI  : 1;
 528      =2              uint8_t bNULL1  : 2;
 529      =2              uint8_t bSLRST  : 1;
 530      =2          }I2CSLCR_Bit;
 531      =2          uint8_t I2CSLCR_U8;  
 532      =2      }rI2CSLCR;
 533      =2  }I2CSLCR_Register;
 534      =2  
 535      =2  /*串口控制寄存器*/
 536      =2  typedef struct 
 537      =2  {
 538      =2      union 
 539      =2      {
 540      =2          struct 
 541      =2          {
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 29  

 542      =2              uint8_t bSM0  : 1;
 543      =2              uint8_t bSM1  : 1;
 544      =2              uint8_t bSM2  : 1;
 545      =2              uint8_t bREN  : 1;
 546      =2              uint8_t bTB8  : 1;
 547      =2              uint8_t bRB8  : 1;
 548      =2              uint8_t bTI   : 1;
 549      =2              uint8_t bRI   : 1;
 550      =2          }SCON_Bit;
 551      =2          uint8_t SCON_U8;  
 552      =2      }SCON;
 553      =2  }SCON_Register;
 554      =2  
 555      =2  /*串口控制寄存器*/
 556      =2  typedef struct 
 557      =2  {
 558      =2      union 
 559      =2      {
 560      =2          struct 
 561      =2          {
 562      =2              uint8_t bS2SM0  : 1;
 563      =2              uint8_t bNULL   : 1;
 564      =2              uint8_t bS2SM2  : 1;
 565      =2              uint8_t bS2REN  : 1;
 566      =2              uint8_t bS2TB8  : 1;
 567      =2              uint8_t bS2RB8  : 1;
 568      =2              uint8_t bS2TI   : 1;
 569      =2              uint8_t bS2RI   : 1;
 570      =2          }S2CON_Bit;
 571      =2          uint8_t S2CON_U8;  
 572      =2      }S2CON;
 573      =2  }S2CON_Register;
 574      =2  
 575      =2  /*串口控制寄存器*/
 576      =2  typedef struct 
 577      =2  {
 578      =2      union 
 579      =2      {
 580      =2          struct 
 581      =2          {
 582      =2              uint8_t bS3SM0  : 1;
 583      =2              uint8_t bS3ST3  : 1;
 584      =2              uint8_t bS3SM2  : 1;
 585      =2              uint8_t bS3REN  : 1;
 586      =2              uint8_t bS3TB8  : 1;
 587      =2              uint8_t bS3RB8  : 1;
 588      =2              uint8_t bS3TI   : 1;
 589      =2              uint8_t bS3RI   : 1;
 590      =2          }S3CON_Bit;
 591      =2          uint8_t S3CON_U8;  
 592      =2      }S3CON;
 593      =2  }S3CON_Register;
 594      =2  
 595      =2  /*串口控制寄存器*/
 596      =2  typedef struct 
 597      =2  {
 598      =2      union 
 599      =2      {
 600      =2          struct 
 601      =2          {
 602      =2              uint8_t bS4SM0  : 1;
 603      =2              uint8_t bS4ST3  : 1;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 30  

 604      =2              uint8_t bS4SM2  : 1;
 605      =2              uint8_t bS4REN  : 1;
 606      =2              uint8_t bS4TB8  : 1;
 607      =2              uint8_t bS4RB8  : 1;
 608      =2              uint8_t bS4TI   : 1;
 609      =2              uint8_t bS4RI   : 1;
 610      =2          }S4CON_Bit;
 611      =2          uint8_t S4CON_U8;  
 612      =2      }S4CON;
 613      =2  }S4CON_Register;
 614      =2  #endif
  10      =1  /*软件定时器个数*/
  11      =1  #define TIMER_EVENTS 50U        
  12      =1  
  13      =1  #define T0X1  0x80
  14      =1  #define T0X12 0x7F
  15      =1  
  16      =1  typedef enum
  17      =1  {
  18      =1          TIMER0 = 0x00,
  19      =1          TIMER1,
  20      =1          TIMER2,
  21      =1          TIMER3,
  22      =1          TIMER4
  23      =1  }Timer_TypsDef;
  24      =1  
  25      =1  /*定时器0模式*/
  26      =1  typedef enum 
  27      =1  {
  28      =1          T0_AutoReload_16bit    = 0xF0,
  29      =1          T0_No_AutoReload_16bit = 0x01,
  30      =1          T0_AutoReload_8bit     = 0x02,
  31      =1          /*Same as mode 0, but interrupts are not maskable*/
  32      =1          T0_SAutoReload_16bit   = 0x03
  33      =1  }Timer0_Mode;
  34      =1  
  35      =1  /*定时器1模式*/
  36      =1  typedef enum
  37      =1  {
  38      =1          T1_AutoReload_16bit    = 0x00,
  39      =1          T1_No_AutoReload_16bit = 0x10,
  40      =1          T1_AutoReload_8bit     = 0x20,
  41      =1          T1_Timer1_Stop         = 0x30
  42      =1  }Timer1_Mode;
  43      =1  
  44      =1  /*定时器辅助寄存器*/
  45      =1  typedef struct 
  46      =1  {
  47      =1          union 
  48      =1          {
  49      =1                  struct 
  50      =1                  {
  51      =1                          uint8_t bT0x12 : 1;
  52      =1                          uint8_t bT1x12 : 1;
  53      =1                          uint8_t bUART_M0x6 : 1;
  54      =1                          uint8_t bT2R : 1;
  55      =1                          uint8_t bT2_C_T : 1;
  56      =1                          uint8_t bT2x12  : 1;
  57      =1                          uint8_t bEXTRAM : 1;
  58      =1                          uint8_t bS1ST2  : 1;
  59      =1                  }AUXR_Bit;
  60      =1                  uint8_t AUXR_U8;        
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 31  

  61      =1          }AUXR;  
  62      =1  }AUXR_Register; //idata AUXR_Register _at_ 0x8e
  63      =1  
  64      =1  /*定时器1/0模式选择寄存器*/
  65      =1  typedef struct
  66      =1  {
  67      =1          union 
  68      =1          {
  69      =1                  struct 
  70      =1                  {
  71      =1                          uint8_t bT1_GATE : 1;
  72      =1                          uint8_t bT1_C_T  : 1;
  73      =1                          uint8_t bT1_M1   : 1;
  74      =1                          uint8_t bT1_M0   : 1;
  75      =1                          uint8_t bT0_GATE : 1;
  76      =1                          uint8_t bT0_C_T  : 1;
  77      =1                          uint8_t bT0_M1   : 1;
  78      =1                          uint8_t bT0_M0   : 1;   
  79      =1                  }TMOD_Bit;
  80      =1                  uint8_t TMOD_U8;        
  81      =1          }TMOD;  
  82      =1  }TMOD_Register;
  83      =1  
  84      =1  
  85      =1  /*定时器3/4控制寄存器*/
  86      =1  typedef struct
  87      =1  {
  88      =1          union 
  89      =1          {
  90      =1                  struct 
  91      =1                  {
  92      =1                          uint8_t bT4R : 1;
  93      =1                          uint8_t bT4_C_T : 1;
  94      =1                          uint8_t bT4x12  : 1;
  95      =1                          uint8_t bT4CLKO : 1;
  96      =1                          uint8_t bT3R : 1;
  97      =1                          uint8_t bT3_C_T : 1;
  98      =1                          uint8_t bT3x12  : 1;
  99      =1                          uint8_t bT3CLKO : 1;
 100      =1                  }T4T3M_Bit;
 101      =1                  uint8_t T4T3M_U8;
 102      =1          }T4T3M;
 103      =1  }T4T3M_Register;
 104      =1  
 105      =1  /*掉电唤醒定时器计数寄存器*/
 106      =1  typedef struct
 107      =1  {
 108      =1          union 
 109      =1          {
 110      =1                  struct
 111      =1                  {
 112      =1                          uint8_t bWKTEN : 1;
 113      =1                          uint8_t bNULL  : 7;
 114      =1                  }WKTCH_Bit;
 115      =1                  uint8_t WKTCH_U8;       
 116      =1          }WKTCH;
 117      =1  }WKTCH_Register;
 118      =1  
 119      =1  // typedef struct
 120      =1  // {
 121      =1  //      Timer_TypsDef Instance;
 122      =1  //      uint8_t Register_AUXR;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 32  

 123      =1  //      uint8_t Timer_Mode;
 124      =1  //      uint16_t Timer_Count;
 125      =1  //      uint8_t RunTimer_Enable : 1;
 126      =1  //      uint8_t Interrupt_Enable : 1;
 127      =1  //      TIMER_NVIC_TypeDef Timer_NVIC;
 128      =1  // }TIM_HandleTypeDef;
 129      =1  
 130      =1  typedef struct
 131      =1  {
 132      =1          Timer_TypsDef Instance;
 133      =1          AUXR_Register AUXR_Reg;
 134      =1          TMOD_Register TMOD_Reg;
 135      =1          uint16_t   Timer_Count;
 136      =1          TIMER_NVIC_TypeDef Timer_NVIC;
 137      =1          IE_Register     IE_Reg;
 138      =1          TCON_Register TCON_Reg;
 139      =1  }TIM_HandleTypeDef;
 140      =1  
 141      =1  typedef void (*event_handle)(void); //large reentrant;
 142      =1  typedef struct
 143      =1  {
 144      =1          uint16_t timercnt;          /*硬件定时中断次数 10ms/次）*/
 145      =1          uint16_t targetcnt;             /*事件定时器中断次数*/
 146      =1          uint8_t  enable;            /*对应事件使能标志*/
 147      =1          uint8_t  execute_flag;  /*对应事件执行标志*/
 148      =1          event_handle ehandle;   /*对应事件接口函数*/
 149      =1  }TIMERS;
 150      =1  
 151      =1  extern TIMERS Timer_Group[TIMER_EVENTS];
 152      =1  extern void Timer0_Init();
 153      =1  extern void Timer1_Init();
 154      =1  
 155      =1  #endif
   3          #include "usart.h"
   1      =1  #ifndef __USART_H
   2      =1  #define __USART_H
   3      =1           
   4      =1  #include "config.h"      
   1      =2  #ifndef __CONFIG_H_
           =2 #define __CONFIG_H_
           =2 
           =2 #include <STC8.H>
           =2 #include <stdio.h>
           =2 #include <intrins.h>
           =2 #include <string.h>
           =2 #include <stdlib.h>
           =2 #include <string.h>
           =2 #include <absacc.h> //可直接操作内存地址
           =2 #include <stdarg.h>
           =2 
           =2 
           =2 /**********************布尔变量定义**********************/
           =2 #define true  1
           =2 #define false 0
           =2 /**********************布尔变量定义**********************/
           =2 
           =2 /***********************************API配置接口***********************************/
           =2 /*使用外部晶振*/
           =2 #define EXTERNAL_CRYSTAL 0 
           =2 /*调试是否启用串口*/
           =2 #define USE_PRINTF_DEBUG 0 
           =2 /*调试选项*/
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 33  

           =2 #define DEBUGGING    0
           =2 /*迪文屏幕使用CRC校验*/
           =2 #define USING_CRC 1
           =2 /*定义WIFI模块相关引脚*/
           =2 #define WIFI_RESET              P23
           =2 #define WIFI_RELOAD             P20
           =2 
           =2 #define COUNTMAX     65536U
           =2 
           =2 /*消除编译器未使用变量警告*/
           =2 #define UNUSED_VARIABLE(x)      ((void)(x))
           =2 #define UNUSED_PARAMETER(x) UNUSED_VARIABLE(x)
           =2 
           =2 //(1/FOSC)*count =times(us)->count = time*FOSC/1000(ms)
           =2 #define FOSC         27000000UL//11059200UL
           =2 /*1ms(时钟频率越高，所能产生的时间越小)*/  
           =2 #define TIMES        10U  
           =2 /*定时器模式选择*/
           =2 #define TIMER_MODE   12U
           =2 /*定时器分频系数，默认为一分频*/  
           =2 #define TIME_DIV     1U  
           =2 #define T12_MODE (TIMES * FOSC / 1000 / 12 / TIME_DIV) 
           =2 #define T1_MODE  (TIMES * FOSC/ 1000 / TIME_DIV)
           =2 #define TIMERS_OVERFLOW (COUNTMAX * 1000 * TIMER_MODE * TIME_DIV) / FOSC
           =2 
           =2 #define OPEN_GLOBAL_OUTAGE()  (EA = 1 << 0)
           =2 #define CLOSE_GLOBAL_OUTAGE() (EA = 0 << 0)
           =2 /*判断延时数是否超出硬件允许范围*/
           =2 #if(TIMES > TIMERS_OVERFLOW)
           =2 #error The timer cannot generate the current duration!
           =2 #endif
           =2 /***********************************API配置接口***********************************/
           =2 
           =2 /***********************************常用的数据类型***********************************/
           =2 typedef unsigned char  uint8_t;
           =2 typedef signed char    int8_t;
           =2 typedef unsigned short int  uint16_t;
           =2 typedef unsigned long  uint32_t;
           =2 typedef signed long    int32_t;
           =2 typedef volatile       __IO;   
           =2 
           =2 /***********************************常用的数据类型***********************************/
           =2 
           =2 /***********************************系统上电参数***********************************/
           =2 #define DEFAULT_SYSTEM_PARAMETER  "\xFF\xFF\xFF\xFF\x02\x01\x00\x84\x50"
           =2 
           =2 /***********************************系统上电参数***********************************/
           =2 
           =2 /***********************************结构体的妙用 ***********************************/
           =2 /*获得结构体(TYPE)的变量成员(MEMBER)在此结构体中的偏移量*/ 
           =2 #define offsetof(TYPE, MEMBER) ((size_t) &((TYPE *)0)->MEMBER)
           =2 /*根据"结构体(type)变量"中的"域成员变量(member)的指针(ptr)"来获取指向整个结构体
             -变量的指针*/ 
           =2 #define container_of(ptr, type, member) ({ \
           =2         const typeof( ((type *)0)->member ) *__mptr = (ptr); \
           =2         (type *)( (char *)__mptr - offsetof(type,member) );}) 
           =2 /***********************************结构体的妙用 ***********************************/
           =2 
           =2 
           =2 extern const uint8_t g_TimerNumbers;
           =2 /***********************************函数声明***********************************/
           =2 void  Gpio_Init(void);
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 34  

           =2 /***********************************函数声明***********************************/
           =2 #endif
   5      =1           
   6      =1  
   7      =1  //以下宏定义用于改变串口的输出引脚
   8      =1  //串口1默认是p30 p31  以下定义的是串口1的切换
   9      =1  // P_SW1 = 0xa2   P_SW2 = 0xba
  10      =1  
  11      =1  
  12      =1  #define USART1_USE_P30_P31         P_SW1 = 0x00
  13      =1  #define USART1_USE_P36_P37         P_SW1 = 0x40
  14      =1  #define USART1_USE_P16_P17         P_SW1 = 0x80
  15      =1  #define USART1_USE_P43_P44         P_SW1 = 0xC0
  16      =1  
  17      =1  //串口2的默认输出引脚为       P10 P11
  18      =1  
  19      =1  #define USART2_USE_P10_P11         P_SW2 = 0x00
  20      =1  #define USART2_USE_P40_P42         P_SW2 = 0x01
  21      =1  
  22      =1  //串口3的默认输出引脚是 P00 P01
  23      =1  
  24      =1  #define USART3_USE_P00_P01         P_SW2 = 0x00
  25      =1  #define USART3_USE_P50_P51         P_SW2 = 0x02
  26      =1  
  27      =1  //串口4的默认输出引脚为 P02 P03
  28      =1  #define USART3_USE_P02_P03         P_SW1 = 0x00
  29      =1  #define USART3_USE_P52_P53         P_SW1 = 0x04
  30      =1  
  31      =1  
  32      =1  //*******************外加485芯片的定义*******************//
  33      =1  #define USART3_EN                       P36
  34      =1  //******************************************************//
  35      =1  
  36      =1  
  37      =1  
  38      =1  #define USEING_PRINTF 0
  39      =1  
  40      =1  /***********************************常用通讯波特率***********************************/
  41      =1  #define BAUD_921600  921600UL
  42      =1  #define BAUD_115200  115200UL
  43      =1  #define BAUD_57600       57600UL
  44      =1  #define BAUD_56000       56000UL
  45      =1  #define BAUD_38400       38400UL
  46      =1  #define BAUD_19200   19200UL
  47      =1  #define BAUD_14400   14400UL
  48      =1  #define BAUD_9600    9600UL
  49      =1  #define BAUD_4800    4800UL
  50      =1  #define BAUD_2400    2400UL
  51      =1  #define BAUD_1200    1200UL
  52      =1  /***********************************常用通讯波特率***********************************/
  53      =1  
  54      =1  #define UART_DIV 4
  55      =1  #define UART_BYTE_SENDOVERTIME (uint16_t)5000U
  56      =1  
  57      =1  #define BRT_1T(BAUD)  (COUNTMAX-FOSC/BAUD/UART_DIV) //1T
  58      =1  #define BRT_12T(BAUD) (COUNTMAX-FOSC/BAUD/UART_DIV/12) //12T
  59      =1  
  60      =1  
  61      =1  typedef enum
  62      =1  {
  63      =1          UART1 = 0x01,
  64      =1          UART2,
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 35  

  65      =1          UART3,
  66      =1          UART4
  67      =1  }Uart_TypsDef;
  68      =1  
  69      =1  
  70      =1  typedef struct //串口中断优先级
  71      =1  {
  72      =1          uint8_t Register_IP;
  73      =1          uint8_t Register_IPH;
  74      =1  }UART_NVIC_TypeDef;
  75      =1  
  76      =1  typedef struct
  77      =1  {
  78      =1          Uart_TypsDef Instance;
  79      =1          uint8_t Register_SCON;
  80      =1          uint8_t Uart_Mode;
  81      =1          uint16_t Uart_Count;
  82      =1          uint8_t RunUart_Enable:1;
  83      =1          uint8_t Interrupt_Enable;
  84      =1          uint8_t Register_AUXR;
  85      =1          uint8_t Uartx_busy:1; //串口接收占用标志
  86      =1          UART_NVIC_TypeDef Uart_NVIC;
  87      =1  }Uart_HandleTypeDef;
  88      =1  
  89      =1  
  90      =1  void Uart_Base_MspInit(Uart_HandleTypeDef *uart_baseHandle);
  91      =1  extern void Uart1_Init(void);
  92      =1  extern void Uart2_Init(void);
  93      =1  extern void Uart3_Init(void);
  94      =1  extern void Uart4_Init(void);
  95      =1  
  96      =1  
  97      =1  void Uartx_SendStr(Uart_HandleTypeDef *const Uart, uint8_t *p, uint8_t length, uint16_t time_out);
  98      =1  void Busy_Await(Uart_HandleTypeDef *const Uart, uint16_t overtime);
  99      =1  void Uartx_Printf(Uart_HandleTypeDef *const uart, const char *format, ...);
 100      =1  
 101      =1  extern Uart_HandleTypeDef Uart1; //串口1句柄
 102      =1  extern Uart_HandleTypeDef Uart2; //串口2句柄
 103      =1  extern Uart_HandleTypeDef Uart3; //串口3句柄
 104      =1  extern Uart_HandleTypeDef Uart4; //串口4句柄
 105      =1  
 106      =1  #endif
   4          #include "charger.h"
   1      =1  #ifndef __CHARGER_H
   2      =1  #define __CHARGER_H
   3      =1  
   4      =1  #ifdef __cplusplus
           =1 extern "C" {
           =1 #endif
   7      =1  #include "SC8913.h"
   1      =2  #ifndef __SC8913_H
   2      =2  #define __SC8913_H
   3      =2  
   4      =2  #ifdef __cplusplus
           =2 extern "C" {
           =2 #endif
   7      =2  #include "IIC.h"
   1      =3  #ifndef __I2C_H
   2      =3  #define __I2C_H
   3      =3  
   4      =3  #ifdef __cplusplus
           =3 extern "C" {
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 36  

           =3 #endif
   7      =3  #include "config.h"
   1      =4  #ifndef __CONFIG_H_
           =4 #define __CONFIG_H_
           =4 
           =4 #include <STC8.H>
           =4 #include <stdio.h>
           =4 #include <intrins.h>
           =4 #include <string.h>
           =4 #include <stdlib.h>
           =4 #include <string.h>
           =4 #include <absacc.h> //可直接操作内存地址
           =4 #include <stdarg.h>
           =4 
           =4 
           =4 /**********************布尔变量定义**********************/
           =4 #define true  1
           =4 #define false 0
           =4 /**********************布尔变量定义**********************/
           =4 
           =4 /***********************************API配置接口***********************************/
           =4 /*使用外部晶振*/
           =4 #define EXTERNAL_CRYSTAL 0 
           =4 /*调试是否启用串口*/
           =4 #define USE_PRINTF_DEBUG 0 
           =4 /*调试选项*/
           =4 #define DEBUGGING    0
           =4 /*迪文屏幕使用CRC校验*/
           =4 #define USING_CRC 1
           =4 /*定义WIFI模块相关引脚*/
           =4 #define WIFI_RESET              P23
           =4 #define WIFI_RELOAD             P20
           =4 
           =4 #define COUNTMAX     65536U
           =4 
           =4 /*消除编译器未使用变量警告*/
           =4 #define UNUSED_VARIABLE(x)      ((void)(x))
           =4 #define UNUSED_PARAMETER(x) UNUSED_VARIABLE(x)
           =4 
           =4 //(1/FOSC)*count =times(us)->count = time*FOSC/1000(ms)
           =4 #define FOSC         27000000UL//11059200UL
           =4 /*1ms(时钟频率越高，所能产生的时间越小)*/  
           =4 #define TIMES        10U  
           =4 /*定时器模式选择*/
           =4 #define TIMER_MODE   12U
           =4 /*定时器分频系数，默认为一分频*/  
           =4 #define TIME_DIV     1U  
           =4 #define T12_MODE (TIMES * FOSC / 1000 / 12 / TIME_DIV) 
           =4 #define T1_MODE  (TIMES * FOSC/ 1000 / TIME_DIV)
           =4 #define TIMERS_OVERFLOW (COUNTMAX * 1000 * TIMER_MODE * TIME_DIV) / FOSC
           =4 
           =4 #define OPEN_GLOBAL_OUTAGE()  (EA = 1 << 0)
           =4 #define CLOSE_GLOBAL_OUTAGE() (EA = 0 << 0)
           =4 /*判断延时数是否超出硬件允许范围*/
           =4 #if(TIMES > TIMERS_OVERFLOW)
           =4 #error The timer cannot generate the current duration!
           =4 #endif
           =4 /***********************************API配置接口***********************************/
           =4 
           =4 /***********************************常用的数据类型***********************************/
           =4 typedef unsigned char  uint8_t;
           =4 typedef signed char    int8_t;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 37  

           =4 typedef unsigned short int  uint16_t;
           =4 typedef unsigned long  uint32_t;
           =4 typedef signed long    int32_t;
           =4 typedef volatile       __IO;   
           =4 
           =4 /***********************************常用的数据类型***********************************/
           =4 
           =4 /***********************************系统上电参数***********************************/
           =4 #define DEFAULT_SYSTEM_PARAMETER  "\xFF\xFF\xFF\xFF\x02\x01\x00\x84\x50"
           =4 
           =4 /***********************************系统上电参数***********************************/
           =4 
           =4 /***********************************结构体的妙用 ***********************************/
           =4 /*获得结构体(TYPE)的变量成员(MEMBER)在此结构体中的偏移量*/ 
           =4 #define offsetof(TYPE, MEMBER) ((size_t) &((TYPE *)0)->MEMBER)
           =4 /*根据"结构体(type)变量"中的"域成员变量(member)的指针(ptr)"来获取指向整个结构体
             -变量的指针*/ 
           =4 #define container_of(ptr, type, member) ({ \
           =4         const typeof( ((type *)0)->member ) *__mptr = (ptr); \
           =4         (type *)( (char *)__mptr - offsetof(type,member) );}) 
           =4 /***********************************结构体的妙用 ***********************************/
           =4 
           =4 
           =4 extern const uint8_t g_TimerNumbers;
           =4 /***********************************函数声明***********************************/
           =4 void  Gpio_Init(void);
           =4 /***********************************函数声明***********************************/
           =4 #endif
   8      =3  
   9      =3  /*延时的个数，5即为延时5Us*/
  10      =3  #define IIC_DELAY 5U
  11      =3  
  12      =3  #define I2C_Fail    0U
  13      =3  #define I2C_Succeed 1U
  14      =3  
  15      =3  /*定义SCL输出的宏定义*/
  16      =3  sbit SCL_CHANNEL0 = P0^0;
  17      =3  sbit SCL_CHANNEL1 = P1^2;
  18      =3  sbit SCL_CHANNEL2 = P4^4;
  19      =3  /*定义SDA输出、读取的宏定义*/
  20      =3  sbit SDA_CHANNEL0 = P2^7;
  21      =3  sbit SDA_CHANNEL1 = P0^5;
  22      =3  sbit SDA_CHANNEL2 = P1^4;
  23      =3  
  24      =3  #define SDA_READ_CHANNELX(CH) \
  25      =3  (CH == Channel0 ? SDA_CHANNEL0 : (CH == Channel1) ? SDA_CHANNEL1 : SDA_CHANNEL2)
  26      =3  
  27      =3  /*IIC层封装*/
  28      =3  typedef enum 
  29      =3  {
  30      =3      Channel0 = 0x00,
  31      =3      Channel1,
  32      =3      Channel2
  33      =3  }IIC_Channel;
  34      =3  
  35      =3  typedef enum 
  36      =3  {
  37      =3      Low  = 0x00,
  38      =3      High = !Low,
  39      =3  }IIC_Pin_State;
  40      =3  
  41      =3  
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 38  

  42      =3  extern void Delay_Us(uint16_t us);              //@11.0592MHz
  43      =3  extern void Delay_Ms(uint16_t ms);              //@11.0592MHz
  44      =3  void Delay_5Us(void);           //@27MHz
  45      =3  
  46      =3  
  47      =3  extern void I2C_Start(IIC_Channel channel); 
  48      =3  extern void I2C_Stop(IIC_Channel channel);
  49      =3  extern void I2C_SendByte(IIC_Channel channel, uint8_t sendByte);
  50      =3  extern uint8_t I2C_WaitAck(IIC_Channel channel, uint16_t timeout);
  51      =3  extern void I2C_SendAck(IIC_Channel channel);
  52      =3  extern void I2C_SendNAck(IIC_Channel channel);
  53      =3  extern uint8_t I2C_ReadByte(IIC_Channel channel); 
  54      =3  extern uint8_t I2C_Set_SCL(IIC_Channel channel, IIC_Pin_State sate); 
  55      =3  extern uint8_t I2C_Set_SDA(IIC_Channel channel, IIC_Pin_State sate); 
  56      =3  
  57      =3  #ifdef __cplusplus
           =3 }
           =3 #endif
  60      =3  
  61      =3  #endif /* __I2C_H */
   8      =2  
   9      =2  /*是否启用外部中断信号检测引脚*/
  10      =2  #define USING_INT_PIN 0
  11      =2  /*是否启用快速充电引脚*/
  12      =2  #define USING_DPORDM_PIN 0
  13      =2  /*硬件是否启用充电使能引脚*/
  14      =2  #define USING_CHARGEING_PIN 0
  15      =2  
  16      =2  /*定义SC8913拓展IO*/
  17      =2  #if (USING_INT_PIN)
           =2 sbit INT_CHANNEL0 = P3^6;
           =2 sbit INT_CHANNEL1 = P3^2;
           =2 sbit INT_CHANNEL2 = P3^7;
           =2 #endif
  22      =2  
  23      =2  #if (USING_DPORDM_PIN)
           =2 sbit DP_CHANNEL0  = P2^1;
           =2 sbit DP_CHANNEL1  = P4^3;
           =2 sbit DP_CHANNEL2  = P0^4;
           =2 
           =2 sbit DM_CHANNEL0  = P2^2;
           =2 sbit DM_CHANNEL1  = P0^2;
           =2 sbit DM_CHANNEL2  = P0^3;
           =2 #endif
  32      =2  
  33      =2  sbit STOP_CHANNEL0  = P0^1;
  34      =2  sbit STOP_CHANNEL1  = P1^3;
  35      =2  sbit STOP_CHANNEL2  = P1^5;
  36      =2  
  37      =2  #if (USING_CHARGEING_PIN)
           =2 sbit CHARGER_CHANNEL0  = P2^4;
           =2 sbit CHARGER_CHANNEL1  = P2^5;
           =2 sbit CHARGER_CHANNEL2  = P2^6;
           =2 #endif
  42      =2  
  43      =2  /*通道数*/
  44      =2  #define CHANNEL_MAX         0x03
  45      =2  /*SC8913寄存器个数*/
  46      =2  #define REGISTER_MAX        0x1C
  47      =2  /*定时读取只读寄存器个数*/
  48      =2  #define READONLY_REGS       0x0B
  49      =2  /*定义支持写寄存器个数*/
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 39  

  50      =2  #define WRITE_OPTION_REGS   0x0D
  51      =2  
  52      =2  /*从机地址*/
  53      =2  #define SAVLE_ADDRESS       0x74
  54      =2  /*从机命令写地址*/
  55      =2  #define SAVLE_WRITE_ADDRESS 0xE8
  56      =2  /*从机命令读地址*/
  57      =2  #define SAVLE_READ_ADDRESS      0xE9
  58      =2  
  59      =2  /*SC8913寄存器地址定义*/
  60      =2  #define VBAT_SET_ADDR               0x00    /**/
  61      =2  #define VBUSREF_I_SET_ADDR              0x01
  62      =2  #define VBUSREF_I_SET2_ADDR             0x02
  63      =2  #define VBUSREF_E_SET_ADDR              0x03
  64      =2  #define VBUSREF_E_SET2_ADDR             0x04
  65      =2  #define IBUS_LIM_SET_ADDR               0x05
  66      =2  #define IBAT_LIM_SET_ADDR               0x06
  67      =2  #define VINREG_SET_ADDR             0x07
  68      =2  #define RATIO_ADDR                      0x08
  69      =2  #define CTRL0_SET_ADDR              0x09
  70      =2  #define CTRL1_SET_ADDR              0x0A
  71      =2  #define CTRL2_SET_ADDR              0x0B
  72      =2  #define CTRL3_SET_ADDR              0x0C
  73      =2  #define VBUS_FB_VALUE_ADDR              0x0D
  74      =2  #define VBUS_FB_VALUE2_ADDR             0x0E
  75      =2  #define VBAT_FB_VALUE_ADDR              0x0F
  76      =2  #define VBAT_FB_VALUE2_ADDR             0x10
  77      =2  #define IBUS_VALUE_ADDR             0x11
  78      =2  #define IBUS_VALUE2_ADDR                0x12
  79      =2  #define IBAT_VALUE_ADDR         0x13
  80      =2  #define IBAT_VALUE2_ADDR            0x14
  81      =2  #define ADIN_VALUE_ADDR         0x15
  82      =2  #define ADIN_VALUE_2_ADDR           0x16
  83      =2  #define STATUS_ADDR                     0x17
  84      =2  #define RESERVED_ADDR           0x18
  85      =2  #define MASK_ADDR                   0x19
  86      =2  #define DP_DM_CTRL_ADDR         0x1A
  87      =2  #define DP_DM_READ_ADDR         0x1B
  88      =2  
  89      =2  #define REG_OK      2U
  90      =2  #define REG_FAILE   3U
  91      =2  
  92      =2  
  93      =2  #define NAME(scr)       #scr
  94      =2  #define REG_R(r)        r##_Reg /*直接拼接字符串，不需要替换*/
  95      =2  #define REG_TYPE(t)     t##_Type
  96      =2  #define REG_Addr(a)     a##_Addr
  97      =2  #define REG_VALUE(v)    v##_U8
  98      =2  #define REG_BIT(b)      b##_Bit
  99      =2  #define BIT_HIGH(h)     b##h##_HIGHT8
 100      =2  #define BIT_LOW(l)      b##l##_LOW2
 101      =2  
 102      =2  /*IBUS端输入阈值电压：低于此值后，芯片将对BAT端限流*/
 103      =2  #define IBUS_THRESHOLD_VOLTAGE 20.0F
 104      =2  /*充电器输入端最大电流*/
 105      =2  #define IBUS_MAX_CURRENT    0.8333F
 106      =2  /*充电器充电通道最大输出电流*/
 107      =2  #define IBAT_MAX_CURRENT    2.00F
 108      =2  /*电路中电流、电压检测电阻：单位mΩ*/
 109      =2  #define CHECK_RESISTANCE     10.0F
 110      =2  /*BUS端输入电压倍率*/
 111      =2  #define VBUS_RAITO           12.5F
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 40  

 112      =2  /*BAT端输入电压倍率:<9v时，采用5x,否则12.5x*/
 113      =2  #define VBAT_RATIO           5.0F
 114      =2  /*BUS端输入电流倍率*/
 115      =2  #define IBUS_RAITO           3.0F
 116      =2  /*BAT端输入电流倍率*/
 117      =2  #define IBAT_RATIO           12.0F
 118      =2  /*电源输入电压比率*/
 119      =2  #define VINREG_RATIO         100.0F
 120      =2  /*设置BUS端电流上限*/
 121      =2  #define SET_IBUS_LIMT(x)     ((256U * (x * CHECK_RESISTANCE) - IBUS_RAITO * 10.0F) / (IBUS_RAITO * 10.0F))
 122      =2  /*设置BAT端电流上限*/
 123      =2  #define SET_IBAT_LIMT(x)     ((256U * (x * CHECK_RESISTANCE) - IBAT_RATIO * 10.0F) / (IBAT_RATIO * 10.0F))
 124      =2  /*设置电源输入电源电压*/
 125      =2  #define SET_VINREG_SET(x)    ((x * 1000.0F - VINREG_RATIO) / VINREG_RATIO)
 126      =2  /*设置VBUS内部参考编程电压*/
 127      =2  #define SET_VBUSREF_I_SET(x) (((x * 1000.0F)/ (2.0F * VBUS_RAITO) - 4.0F) / 4.0F)
 128      =2  /*1S-2S电池设置VBAT_MON_RATIO位为1;3S-4S电池设置VBAT_MON_RATIO位为0*/
 129      =2  #define SET_RATIO(x)         (x ? (0x02 | 0x38) : (0xFD & 0x38))
 130      =2  /*当AC_ok为0时，设置AC_DEF=0;当AC_ok为1时，设置AC_DEF=1*/
 131      =2  #define SET_CTRL0_SET(x)     (x ? (0x20 | 0x04) : (0xDF & 0x04)) 
 132      =2  /*x=1时，选择BAT端电流作为IBAT上限;x=0时，选择BUS端电流作为IBAT上限*/
 133      =2  #define SET_CTRL1_SET(x)     (x ? (0x80 | 0x01) : (0x7F & 0x01))
 134      =2  /*x=1时，退出工厂模式;x=0时，进入工厂模式*/
 135      =2  #define SET_CTRL2_SET(x)     (x ? (0x08 | 0x01) : (0xF7 & 0x01))
 136      =2  /*x=1时，打开ADC;x=0时，关闭ADC*/
 137      =2  #define SET_CTRL3_SET(x)     (x ? (0x20 | 0x02) : (0xDF & 0x02))
 138      =2  /*得到只读寄存器在g_Sc8913_Registers数组中下标*/
 139      =2  #define GET_SITE(x)           (x - VBUS_FB_VALUE_ADDR)
 140      =2  
 141      =2  #define READ_VBUS_VALUE(ch, addr)    ((4U * g_Sc8913_Registers[ch][addr] \
 142      =2                                    +  (((g_Sc8913_Registers[ch][addr + 1]) & 0xc0) >> 6U) + 1.0F) * 2.0F * 
             -VBUS_RAITO / 1000.0F)
 143      =2  #define READ_VBAT_VALUE(ch, addr)    ((4U * g_Sc8913_Registers[ch][addr] \
 144      =2                                    +  (((g_Sc8913_Registers[ch][addr + 1]) & 0xc0) >> 6U) + 1.0F) * 2.0F * 
             -VBAT_RATIO / 1000.0F)
 145      =2  #define READ_IBUS_VALUE(ch, addr)    ((4U * g_Sc8913_Registers[ch][addr] \
 146      =2                                    +  (((g_Sc8913_Registers[ch][addr + 1]) & 0xc0) >> 6U) + 1.0F) / 600.0F 
             -* IBUS_RAITO)
 147      =2  #define READ_IBAT_VALUE(ch, addr)    ((4U * g_Sc8913_Registers[ch][addr] \
 148      =2                                    +  (((g_Sc8913_Registers[ch][addr + 1]) & 0xc0) >> 6U) + 1.0F) / 600.0F 
             -* IBAT_RATIO)
 149      =2  
 150      =2  /*SC8913寄存器定义*/
 151      =2  typedef enum
 152      =2  {
 153      =2      Write = 0x00,
 154      =2      Read,
 155      =2      Both
 156      =2  }Reg_Type;
 157      =2  
 158      =2  /****************************************寄存器VBAT_SET************************************/
 159      =2  typedef enum
 160      =2  {
 161      =2      R_0m = 0x00, /*0mΩ*/
 162      =2      R_20m,
 163      =2      R_40m,
 164      =2      R_80m
 165      =2  }Vbat_IRCompensation;
 166      =2  
 167      =2  typedef enum
 168      =2  {
 169      =2      Inside_Mode = 0x00, /*内部模式*/
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 41  

 170      =2      External_Mode
 171      =2  }Vbat_Mode;
 172      =2  
 173      =2  typedef enum
 174      =2  {
 175      =2      One_Cell = 0x00, /*单节*/
 176      =2      Two_Cell,
 177      =2      Three_Cell,
 178      =2      Four_Cell
 179      =2  }Vbat_Units;
 180      =2  
 181      =2  typedef enum
 182      =2  {
 183      =2      V4_10 = 0x00, /*4.1V*/
 184      =2      V4_20,
 185      =2      V4_25,
 186      =2      V4_30,
 187      =2      V4_35,
 188      =2      V4_40,
 189      =2      V4_45,
 190      =2      V4_50
 191      =2  }Vbat_Units_Voltage;
 192      =2  
 193      =2  /*充电设置寄存器*/
 194      =2  typedef struct 
 195      =2  {
 196      =2          Reg_Type VBAT_SET_Type;
 197      =2      uint8_t  VBAT_SET_Addr;
 198      =2      union 
 199      =2          {
 200      =2                  struct 
 201      =2                  {
 202      =2                          uint8_t bIRCOMP  : 2; /*电池充电内部电阻补偿*/
 203      =2                          uint8_t bVBAT_SEL : 1; /*充电电压选择设置*/
 204      =2                          uint8_t bCSEL    : 2; /*内部电压设置模式下，充电电池节数选择*/
 205      =2                          uint8_t bVCELL_SET : 3; /*内部电压设置模式下，每节电池充电截止电压设置*/
 206      =2                  }VBAT_SET_Bit;
 207      =2                  uint8_t VBAT_SET_U8;    
 208      =2          }VBAT_SET;      
 209      =2  }VBAT_SET_Register;/*default value: 0x01*/ 
 210      =2  /****************************************寄存器VBAT_SET************************************/
 211      =2  
 212      =2  /****************************************寄存器VBUSREF_I_SET************************************/
 213      =2  /*电源总线内部模式参考电压设置寄存器*/
 214      =2  typedef struct 
 215      =2  {
 216      =2          Reg_Type VBUSREF_I_SET_Type;
 217      =2      uint8_t  VBUSREF_I_SET_Addr;
 218      =2      union 
 219      =2          {
 220      =2                  uint8_t VBUSREF_I_SET_U8; /*为内部VBUS编程设置的参考电压*/  
 221      =2          }VBUSREF_I_SET; 
 222      =2  }VBUSREF_I_SET_Register;/*default value: 0x31*/ 
 223      =2  
 224      =2  /*电源总线内部模式参考电压设置寄存器*/
 225      =2  typedef struct 
 226      =2  {
 227      =2          Reg_Type VBUSREF_I_SET2_Type;
 228      =2      uint8_t  VBUSREF_I_SET2_Addr;
 229      =2      union 
 230      =2          {
 231      =2                  struct 
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 42  

 232      =2                  {
 233      =2                          uint8_t bVBUSREF_I_SET_2  : 2; /*为内部VBUS编程设置的参考电压*/
 234      =2                          uint8_t bRESERVED : 6; 
 235      =2                  }VBUSREF_I_SET2_Bit;
 236      =2                  uint8_t VBUSREF_I_SET2_U8;      
 237      =2          }VBUSREF_I_SET2;        
 238      =2  }VBUSREF_I_SET2_Register;/*default value: 0x11xx xxxx*/ 
 239      =2  
 240      =2  /****************************************寄存器VBUSREF_I_SET************************************/
 241      =2  
 242      =2  /****************************************寄存器IBUS_LIM_SET************************************/
 243      =2  /*输入源电流上限设置寄存器*/
 244      =2  typedef struct 
 245      =2  {
 246      =2          Reg_Type IBUS_LIM_SET_Type;
 247      =2      uint8_t  IBUS_LIM_SET_Addr;
 248      =2      union 
 249      =2          {
 250      =2                  uint8_t IBUS_LIM_SET_U8; /*为内部VBUS编程设置的参考电压*/   
 251      =2          }IBUS_LIM_SET;  
 252      =2  }IBUS_LIM_SET_Register;/*default value: 0xFF*/ 
 253      =2  
 254      =2  /*输入源电压上限设置寄存器*/
 255      =2  typedef struct 
 256      =2  {
 257      =2          Reg_Type IBAT_LIM_SET_Type;
 258      =2      uint8_t  IBAT_LIM_SET_Addr;
 259      =2      union 
 260      =2          {
 261      =2                  uint8_t IBAT_LIM_SET_U8; /*为内部VBUS编程设置的参考电压*/   
 262      =2          }IBAT_LIM_SET;  
 263      =2  }IBAT_LIM_SET_Register;/*default value: 0xFF*/ 
 264      =2  
 265      =2  /*充电模式下，输入源电压范围设置寄存器*/
 266      =2  typedef struct 
 267      =2  {
 268      =2          Reg_Type VINRANG_SET_Type;
 269      =2      uint8_t  VINRANG_SET_Addr;
 270      =2      union 
 271      =2          {
 272      =2          uint8_t VINRANG_SET_U8; /*设置输入源电压的范围*/      
 273      =2          }VINRANG_SET;   
 274      =2  }VINRANG_SET_Register;/*default value: 0x2C*/ 
 275      =2  /****************************************寄存器寄存器IBUS_LIM_SET***********************************
             -*/
 276      =2  
 277      =2  /*BUS、BAT总线上电压、电流倍率设置寄存器*/
 278      =2  typedef struct 
 279      =2  {
 280      =2          Reg_Type RATIO_Type;
 281      =2      uint8_t  RATIO_Addr;
 282      =2      union 
 283      =2          {
 284      =2          struct 
 285      =2          {
 286      =2              uint8_t bNULL : 3;
 287      =2              uint8_t bIBAT_RATIO :1; /*设置BAT总线电流倍率*/
 288      =2              uint8_t bIBUS_RATIO : 2; /*设置BUS总线电流倍率*/
 289      =2              uint8_t bVBAT_MON_RATIO : 1;  /*设置BAT总线电压倍率*/
 290      =2              uint8_t bVBUS_RATIO : 1;  /*设置BAT总线电压倍率*/
 291      =2          }RATIO_Bit;
 292      =2          uint8_t RATIO_U8; /*设置BUS、BAT总线的电压、电流倍率*/     
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 43  

 293      =2          }RATIO;
 294      =2  }RATIO_Register;/*default value: 0x38*/ 
 295      =2  
 296      =2  /*CTRLX_SET设置寄存器*/
 297      =2  typedef struct 
 298      =2  {
 299      =2          Reg_Type CTRL0_SET_Type;
 300      =2      uint8_t  CTRL0_SET_Addr;
 301      =2      union 
 302      =2          {
 303      =2          struct 
 304      =2          {
 305      =2              uint8_t bEN_OTG : 1; /*充放电模式选择*/
 306      =2              uint8_t bNULL : 1; 
 307      =2              uint8_t bAC_DET : 1; /*交流插拔检测控制位*/
 308      =2              uint8_t bVINREG_RATIO : 1;  /*设置输入电源电压倍率*/
 309      =2              uint8_t bFREQ_SET : 1;  /*设置开关频率*/
 310      =2              uint8_t bDT_SET : 2; /*设置开关死区时间*/
 311      =2          }CTRL0_SET_Bit;
 312      =2          uint8_t CTRL0_SET_U8;   
 313      =2          }CTRL0_SET;     
 314      =2  }CTRL0_SET_Register;/*default value: 0x04*/ 
 315      =2  
 316      =2  typedef struct 
 317      =2  {
 318      =2          Reg_Type CTRL1_SET_Type;
 319      =2      uint8_t  CTRL1_SET_Addr;
 320      =2      union 
 321      =2          {
 322      =2          struct 
 323      =2          {
 324      =2              uint8_t bICHAE_SEL : 1; /*充电模式下，最终能够输出的电流极限参考选择（IB
             -US/IBAT）*/
 325      =2              uint8_t bDIS_TRICKLE : 1; /*是否启用涓流模式*/
 326      =2              uint8_t bDIS_TERM : 1; /*充电终止控制*/
 327      =2              uint8_t bFB_SEL : 1;  /*VBUS控制电压设置，仅适用于放电模式*/
 328      =2              uint8_t bTRICKLE_SET : 1;  /*涓流模式的开启设置为VBAT的%x，默认为VBAT*%60*/
 329      =2              uint8_t bDIS_OVP : 1; /*放电模式的OVP保护设置*/
 330      =2              uint8_t bNULL : 2;
 331      =2          }CTRL1_SET_Bit;
 332      =2          uint8_t CTRL1_SET_U8;   
 333      =2          }CTRL1_SET;     
 334      =2  }CTRL1_SET_Register;/*default value: 0x01*/
 335      =2  
 336      =2  typedef struct 
 337      =2  {
 338      =2          Reg_Type CTRL2_SET_Type;
 339      =2      uint8_t  CTRL2_SET_Addr;
 340      =2      union 
 341      =2          {
 342      =2          struct 
 343      =2          {
 344      =2              uint8_t bNULL : 4; 
 345      =2              uint8_t bFACTORY : 1; /*工厂设置位。通电后，MCU应将这一位写成1*/
 346      =2              uint8_t bEN_DITHEM : 1; /*是否启用开关频率抖动功能*/
 347      =2              uint8_t bSLEW_SET  : 2;  /*放电模式下的参考电压旋转率/变化速率设置*/
 348      =2          }CTRL2_SET_Bit;
 349      =2          uint8_t CTRL2_SET_U8;   
 350      =2          }CTRL2_SET;     
 351      =2  }CTRL2_SET_Register;/*default value: 0x01*/
 352      =2  
 353      =2  typedef struct 
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 44  

 354      =2  {
 355      =2          Reg_Type CTRL3_SET_Type;
 356      =2      uint8_t  CTRL3_SET_Addr;
 357      =2      union 
 358      =2          {
 359      =2          struct 
 360      =2          {
 361      =2              uint8_t bEN_PGATE : 1; /*PMOS控制*/ 
 362      =2              uint8_t bGPO_CTRL : 1; /*GPO输出控制*/
 363      =2              uint8_t bAD_START : 1; /*是否启用ADC*/
 364      =2              uint8_t bILIM_BW_SEL  : 1;  /*ILIM循环带宽设置*/
 365      =2              uint8_t bLOOP_SET : 1; /*循环响应控制*/
 366      =2              uint8_t bDIS_SHORTFOLDBACK : 1; /*IBUS电流折叠控制为VBUS短路情况，仅在放电模
             -下有效*/
 367      =2              uint8_t bEOC_SET : 1; /*充电结束阶段目标电流与充电电流倍率*/
 368      =2              uint8_t bEN_PFM  : 1; /*光照条件下的PFM控制，仅针对放电模式*/
 369      =2          }CTRL3_SET_Bit;
 370      =2          uint8_t CTRL3_SET_U8;   
 371      =2          }CTRL3_SET;     
 372      =2  }CTRL3_SET_Register;/*default value: 0x02*/
 373      =2  
 374      =2  /****************************************只读寄存器************************************/
 375      =2  typedef struct 
 376      =2  {
 377      =2          Reg_Type VBUS_FB_VALUE_Type;
 378      =2      uint8_t  VBUS_FB_VALUE_Addr;
 379      =2      union 
 380      =2          {
 381      =2          struct 
 382      =2          {
 383      =2              
 384      =2              uint8_t bVBUS_FB_VALUE_HULL : 6;
 385      =2              uint8_t bVBUS_FB_VALUE_HIGHT8 : 8;  
 386      =2              uint8_t bVBUS_FB_VALUE_LOW2   : 2;
 387      =2          }VBUS_FB_VALUE_Bit;
 388      =2          uint16_t VBUS_FB_VALUE_U8;      
 389      =2          }VBUS_FB_VALUE; 
 390      =2  }VBUS_FB_VALUE_Register;
 391      =2  
 392      =2  typedef struct 
 393      =2  {
 394      =2          Reg_Type VBAT_FB_VALUE_Type;
 395      =2      uint8_t  VBAT_FB_VALUE_Addr;
 396      =2      union 
 397      =2          {
 398      =2          struct 
 399      =2          {
 400      =2              
 401      =2              uint8_t bVBAT_FB_VALUE_HULL : 6;
 402      =2              uint8_t bVBAT_FB_VALUE_HIGHT8 : 8;  
 403      =2              uint8_t bVBAT_FB_VALUE_LOW2   : 2;
 404      =2          }VBAT_FB_VALUE_Bit;
 405      =2          uint16_t VBAT_FB_VALUE_U8;      
 406      =2          }VBAT_FB_VALUE; 
 407      =2  }VBAT_FB_VALUE_Register;
 408      =2  
 409      =2  typedef struct 
 410      =2  {
 411      =2          Reg_Type IBUS_FB_VALUE_Type;
 412      =2      uint8_t  IBUS_FB_VALUE_Addr;
 413      =2      union 
 414      =2          {
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 45  

 415      =2          struct 
 416      =2          {
 417      =2              
 418      =2              uint8_t bIBUS_FB_VALUE_HULL : 6;
 419      =2              uint8_t bIBUS_FB_VALUE_HIGHT8 : 8;  
 420      =2              uint8_t bIBUS_FB_VALUE_LOW2   : 2;
 421      =2          }IBUS_FB_VALUE_Bit;
 422      =2          uint16_t IBUS_FB_VALUE_U8;      
 423      =2          }IBUS_FB_VALUE; 
 424      =2  }IBUS_FB_VALUE_Register;
 425      =2  
 426      =2  typedef struct 
 427      =2  {
 428      =2          Reg_Type IBAT_FB_VALUE_Type;
 429      =2      uint8_t  IBAT_FB_VALUE_Addr;
 430      =2      union 
 431      =2          {
 432      =2          struct 
 433      =2          {
 434      =2              
 435      =2              uint8_t bIBAT_FB_VALUE_HULL : 6;
 436      =2              uint8_t bIBAT_FB_VALUE_HIGHT8 : 8;  
 437      =2              uint8_t bIBAT_FB_VALUE_LOW2   : 2;
 438      =2          }IBAT_FB_VALUE_Bit;
 439      =2          uint16_t IBAT_FB_VALUE_U8;      
 440      =2          }IBAT_FB_VALUE; 
 441      =2  }IBAT_FB_VALUE_Register;
 442      =2  
 443      =2  
 444      =2  typedef struct 
 445      =2  {
 446      =2          Reg_Type MASK_Type;
 447      =2      uint8_t  MASK_Addr;
 448      =2      union 
 449      =2          {
 450      =2          struct 
 451      =2          {
 452      =2              
 453      =2              uint8_t bDM_L_MASK : 1; /*检测到DM中断设置位*/
 454      =2              uint8_t bAC_OK_MASK : 1; /*插入交流适配器中断设置位*/  
 455      =2              uint8_t bINDET2_MASK : 1; /*USB-A在INDET2针脚处检测到一个负载插入中断设置位*
             -/
 456      =2              uint8_t bINDET1_MASK : 1; /*USB-A在INDET1针脚处检测到一个负载插入中断设置位*
             -/
 457      =2              uint8_t bVBUS_SHORT_MASK : 1; /*在放电模式下发生VBUS短路故障中断设置位*/
 458      =2              uint8_t bVBUS_OTP_MASK : 1; /*OTP故障发生中断设置位*/
 459      =2              uint8_t bVBUS_EOC_MASK : 1; /*满足EOC条件中断设置位*/
 460      =2              uint8_t bNULL : 1;
 461      =2          }MASK_Bit;
 462      =2          uint8_t MASK_U8;        
 463      =2          }MASK;  
 464      =2  }MASK_Register;
 465      =2  
 466      =2  /****************************************只读寄存器************************************/
 467      =2  
 468      =2  
 469      =2  typedef struct 
 470      =2  {
 471      =2          Reg_Type STATUS_Type;
 472      =2      uint8_t  STATUS_Addr;
 473      =2      union 
 474      =2          {
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 46  

 475      =2          struct 
 476      =2          {
 477      =2              
 478      =2              uint8_t bDM_L : 1; /*检测到DM电压低于0.325V*/
 479      =2              uint8_t bAC_OK : 1; /*插入交流适配器*/  
 480      =2              uint8_t bINDET2 : 1; /*USB-A在INDET2针脚处检测到一个负载插入*/
 481      =2              uint8_t bINDET1 : 1; /*USB-A在INDET1针脚处检测到一个负载插入*/
 482      =2              uint8_t bVBUS_SHORT : 1; /*在放电模式下发生VBUS短路故障*/
 483      =2              uint8_t bVBUS_OTP : 1; /*OTP故障发生*/
 484      =2              uint8_t bVBUS_EOC : 1; /*满足EOC条件*/
 485      =2              uint8_t bNULL : 1;
 486      =2          }STATUS_Bit;
 487      =2          uint8_t STATUS_U8;      
 488      =2          }STATUS;        
 489      =2  }STATUS_Register;
 490      =2  
 491      =2  extern data uint8_t g_Sc8913_Registers[CHANNEL_MAX][REGISTER_MAX]; 
 492      =2  extern uint8_t Sc8913_Init(void);
 493      =2  extern void Set_Sc8913_Stop(IIC_Channel channel, IIC_Pin_State state);
 494      =2  extern void Set_Sc8913_charger(IIC_Channel channel, IIC_Pin_State state);
 495      =2  extern uint8_t Sc8913_Write_Register(IIC_Channel channel, uint8_t start_addr, uint8_t *dat, uint8_t length
             -);
 496      =2  extern uint8_t Sc8913_Read_Register(IIC_Channel channel, uint8_t start_addr, uint8_t *dat, uint8_t length)
             -;
 497      =2  extern uint8_t Read_Register_Value(IIC_Channel channel);
 498      =2  #ifdef __cplusplus
           =2 }
           =2 #endif
 501      =2  
 502      =2  #endif /* __SC8913_H */
   8      =1  
   9      =1  /*SC9813最低检测电流>0.3A*/
  10      =1  #define CHECK_CURRENT       0.3F
  11      =1  /*涓流阶段电流时IBAT的1/10*/
  12      =1  #define TRICKLE_CURRNET     (0.1F * IBAT_MAX_CURRENT)
  13      =1  /*通道电压下限2.0V*/
  14      =1  #define LOWEST_VOLTAGE          2.0F      
  15      =1  /*锂电池单节允许最高电压*/
  16      =1  #define ONCE_MAXVOLTAGE     4.20F
  17      =1  /*锂电池单节允许最低电压为SC8913BAT电压的70%*/
  18      =1  #define ONCE_MINVOLTAGE     (ONCE_MAXVOLTAGE * 0.7F)
  19      =1  /*SC8913认为充满时电压*/
  20      =1  #define ONCE_FULLVOLTAGE    (ONCE_MAXVOLTAGE * 0.98F)
  21      =1  /*断路次数*/
  22      =1  #define OPENTIME            50U
  23      =1  
  24      =1  /*定义STATUS寄存器位*/
  25      =1  #define EOC_BIT 0x01
  26      =1  #define OTP_BIT 0x02
  27      =1  #define VBUS_SHORT_BIT 0x03
  28      =1  #define INDET1_BIT 0x04
  29      =1  #define INDET2_BIT 0x05
  30      =1  #define AC_OK_BIT 0x06
  31      =1  #define DM_L_BIT 0x07
  32      =1  
  33      =1  #define REVISE_REGISTER(ch, value, ratio, result) \
  34      =1  do \
  35      =1  { \
  36      =1      if(Sc8913_Write_Register(ch->Channel_Id, VBAT_SET_ADDR, &value ,1U)) \
  37      =1      { \
  38      =1          result = true; \
  39      =1      } \
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 47  

  40      =1      if(ratio == true) \
  41      =1      { \
  42      =1          p_ch->Vbat_Ratio = VBAT_RATIO; \
  43      =1      }\
  44      =1      else \
  45      =1      { \
  46      =1          p_ch->Vbat_Ratio = VBAT_RATIO * 2.5F; \
  47      =1      } \
  48      =1          value = SET_RATIO(ratio); \
  49      =1          if(Sc8913_Write_Register(ch->Channel_Id, RATIO_ADDR, &value ,1U)) \
  50      =1      { \
  51      =1          result = true; \
  52      =1      } \
  53      =1  }while(0);
  54      =1  
  55      =1  
  56      =1  /*设备类型*/
  57      =1  typedef enum
  58      =1  {
  59      =1          Cell = 0x00,
  60      =1          Dcdc,
  61      =1          No_Device,
  62      =1  }Device_Type;
  63      =1  
  64      =1  /*充电状态*/
  65      =1  typedef enum
  66      =1  {   
  67      =1      /*涓流充电*/
  68      =1          Trickle_Mode = 0x00,
  69      =1      /*恒流充电*/    
  70      =1          Constant_Current_Mode,
  71      =1      /*恒压充电*/    
  72      =1          Constant_Voltage_Mode,
  73      =1      /*充电结束*/    
  74      =1          End_Charging,   
  75      =1      /*待机模式*/
  76      =1      stdantby_Mode       
  77      =1  }Charging_State;    
  78      =1  
  79      =1  /*前台实时上报数据*/
  80      =1  typedef struct
  81      =1  {   /*上报的电压*/
  82      =1          float Voltage;
  83      =1      /*上报的电流*/ 
  84      =1          float Current;
  85      =1      /*充电时长*/    
  86      =1          uint32_t Time;  
  87      =1      /*充电电量*/
  88      =1          float Electricity; 
  89      =1  }Foreground_Parameters;     
  90      =1  
  91      =1  /*后台上报数据*/
  92      =1  typedef struct
  93      =1  {
  94      =1          float Trickle_Target_Current;                   //涓流目标电流
  95      =1          float Trickle_Target_Voltage;                   //涓流目标电压
  96      =1  
  97      =1          float ConstantCurrent_Target_Current;   //恒流目标电流
  98      =1          float ConstantCurrent_Target_Voltage;   //恒流目标电压
  99      =1  
 100      =1          float ConstantVoltage_Target_Current;   //恒压目标电流
 101      =1          float ConstantVoltage_Target_Voltage;   //恒压目标电压
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 48  

 102      =1  }Background_Parameters;
 103      =1  
 104      =1  
 105      =1  typedef struct 
 106      =1  {
 107      =1      /*当前通道ID*/
 108      =1      IIC_Channel Channel_Id;
 109      =1      /*设备类型*/    
 110      =1      Device_Type    Dev_Type;
 111      =1      /*锂电池节数*/
 112      =1      uint8_t Batterry_Numbers;
 113      =1      /*充电状态*/
 114      =1          Charging_State  CState;
 115      =1      /*前台参数*/
 116      =1      Foreground_Parameters For_ChargingPara;
 117      =1      Background_Parameters Bac_ChargingPara;
 118      =1      struct 
 119      =1      {   /*充电器后台参数地址*/
 120      =1          uint32_t Back_Para_Addr;                                   
 121      =1          /*充电动画地址*/
 122      =1              uint32_t Animation_Addr;      
 123      =1          /*充电状态地址*/
 124      =1              uint32_t State_Addr;
 125      =1      }Charger_Show_Addr;    
 126      =1      struct 
 127      =1      {   /*正在充电标志*/
 128      =1          volatile uint8_t Is_ChargingFlag;
 129      =1          /*充电动画状态 */                    
 130      =1              volatile uint8_t Cartoon_Flag;
 131      =1          /*过流标志*/        
 132      =1              volatile uint8_t OverCurrent_Flag;   
 133      =1      }Charger_Flag; 
 134      =1      /*不同电池节数下的VBA倍率*/
 135      =1      float Vbat_Ratio;          
 136      =1  }Charging_Typedef;
 137      =1  
 138      =1  extern const Charging_Typedef g_Charger[CHANNEL_MAX];
 139      =1  extern void Charging_Poll(Charging_Typedef *const p_ch);
 140      =1  extern void Report_ChargerInfo(Charging_Typedef *const p_ch);
 141      =1  #ifdef __cplusplus
           =1 }
           =1 #endif
 144      =1  
 145      =1  #endif /* __SC8913_H */
   5          #include "wifi.h"
   1      =1  /********************************************************************
   2      =1   **--------------文件信息---------------------------------------------
   3      =1   **文   件   名：wifi.h
   4      =1   **创 建  日 期：2021年4月9日
   5      =1   **最后修改日期：
   6      =1   **版 权 信  息: 云南兆富科技有限公司
   7      =1   **程   序   员：LHC
   8      =1   **版   本   号：V3.0
   9      =1   **描        述：WIFI驱动程序（USR-C215）
  10      =1   **修 改 日  志:
  11      =1   *********************************************************************/
  12      =1  #ifndef _WIFI_H_
  13      =1  #define _WIFI_H_
  14      =1  
  15      =1  #ifdef  __cplusplus
           =1 extern "C" {
           =1 #endif
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 49  

  18      =1  
  19      =1  #include "config.h"
   1      =2  #ifndef __CONFIG_H_
           =2 #define __CONFIG_H_
           =2 
           =2 #include <STC8.H>
           =2 #include <stdio.h>
           =2 #include <intrins.h>
           =2 #include <string.h>
           =2 #include <stdlib.h>
           =2 #include <string.h>
           =2 #include <absacc.h> //可直接操作内存地址
           =2 #include <stdarg.h>
           =2 
           =2 
           =2 /**********************布尔变量定义**********************/
           =2 #define true  1
           =2 #define false 0
           =2 /**********************布尔变量定义**********************/
           =2 
           =2 /***********************************API配置接口***********************************/
           =2 /*使用外部晶振*/
           =2 #define EXTERNAL_CRYSTAL 0 
           =2 /*调试是否启用串口*/
           =2 #define USE_PRINTF_DEBUG 0 
           =2 /*调试选项*/
           =2 #define DEBUGGING    0
           =2 /*迪文屏幕使用CRC校验*/
           =2 #define USING_CRC 1
           =2 /*定义WIFI模块相关引脚*/
           =2 #define WIFI_RESET              P23
           =2 #define WIFI_RELOAD             P20
           =2 
           =2 #define COUNTMAX     65536U
           =2 
           =2 /*消除编译器未使用变量警告*/
           =2 #define UNUSED_VARIABLE(x)      ((void)(x))
           =2 #define UNUSED_PARAMETER(x) UNUSED_VARIABLE(x)
           =2 
           =2 //(1/FOSC)*count =times(us)->count = time*FOSC/1000(ms)
           =2 #define FOSC         27000000UL//11059200UL
           =2 /*1ms(时钟频率越高，所能产生的时间越小)*/  
           =2 #define TIMES        10U  
           =2 /*定时器模式选择*/
           =2 #define TIMER_MODE   12U
           =2 /*定时器分频系数，默认为一分频*/  
           =2 #define TIME_DIV     1U  
           =2 #define T12_MODE (TIMES * FOSC / 1000 / 12 / TIME_DIV) 
           =2 #define T1_MODE  (TIMES * FOSC/ 1000 / TIME_DIV)
           =2 #define TIMERS_OVERFLOW (COUNTMAX * 1000 * TIMER_MODE * TIME_DIV) / FOSC
           =2 
           =2 #define OPEN_GLOBAL_OUTAGE()  (EA = 1 << 0)
           =2 #define CLOSE_GLOBAL_OUTAGE() (EA = 0 << 0)
           =2 /*判断延时数是否超出硬件允许范围*/
           =2 #if(TIMES > TIMERS_OVERFLOW)
           =2 #error The timer cannot generate the current duration!
           =2 #endif
           =2 /***********************************API配置接口***********************************/
           =2 
           =2 /***********************************常用的数据类型***********************************/
           =2 typedef unsigned char  uint8_t;
           =2 typedef signed char    int8_t;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 50  

           =2 typedef unsigned short int  uint16_t;
           =2 typedef unsigned long  uint32_t;
           =2 typedef signed long    int32_t;
           =2 typedef volatile       __IO;   
           =2 
           =2 /***********************************常用的数据类型***********************************/
           =2 
           =2 /***********************************系统上电参数***********************************/
           =2 #define DEFAULT_SYSTEM_PARAMETER  "\xFF\xFF\xFF\xFF\x02\x01\x00\x84\x50"
           =2 
           =2 /***********************************系统上电参数***********************************/
           =2 
           =2 /***********************************结构体的妙用 ***********************************/
           =2 /*获得结构体(TYPE)的变量成员(MEMBER)在此结构体中的偏移量*/ 
           =2 #define offsetof(TYPE, MEMBER) ((size_t) &((TYPE *)0)->MEMBER)
           =2 /*根据"结构体(type)变量"中的"域成员变量(member)的指针(ptr)"来获取指向整个结构体
             -变量的指针*/ 
           =2 #define container_of(ptr, type, member) ({ \
           =2         const typeof( ((type *)0)->member ) *__mptr = (ptr); \
           =2         (type *)( (char *)__mptr - offsetof(type,member) );}) 
           =2 /***********************************结构体的妙用 ***********************************/
           =2 
           =2 
           =2 extern const uint8_t g_TimerNumbers;
           =2 /***********************************函数声明***********************************/
           =2 void  Gpio_Init(void);
           =2 /***********************************函数声明***********************************/
           =2 #endif
  20      =1  
  21      =1  /*定义WIFI模块相关引脚*/
  22      =1  #define WIFI_RESET              P23
  23      =1  #define WIFI_RELOAD             P20
  24      =1  
  25      =1  /*定义设备ID*/
  26      =1  #define DRIVERS_ID "32"
  27      =1  /*定义热点ID*/
  28      =1  #define AP_ID "ChargerPlus"
  29      =1  /*转化为字符串*/
  30      =1  #define SWITCH_STR(S) #S
  31      =1  /*拼接一个宏定义和字符串*/
  32      =1  #define STR_MCRO() ("AT+WAP=" AP_ID ",NONE\r\n")
  33      =1  /*连接两个字符串S1、S2*/
  34      =1  #define STR_CONNECT(S1,S2) (S1##""##S2)
  35      =1  /*当前设备热点名称*/
  36      =1  #define AP_NAME  STR_MCRO()//"AT+WAP=PLC7_AP,NONE\r\n"
  37      =1  /*当前设备云平台设备号*/
  38      =1  #define CLOUD_ID "AT+REGCLOUD=000196390000000000" DRIVERS_ID ",SkdGAzyl\r\n"
  39      =1  /*当前WIFI模块工作方式*/
  40      =1  #define AP_STA_MODE "AT+WMODE=APSTA\r\n"
  41      =1  #define STA_MODE "AT+WMODE=APSTA\r\n"
  42      =1  /*进入透传模式命令*/
  43      =1  #define ENTM_CMD "AT+ENTM\r\n"
  44      =1  /*模块重启命令*/
  45      =1  #define RESTART_CMD "AT+Z\r\n"
  46      =1  
  47      =1  typedef unsigned char (*event)(void);
  48      =1  typedef struct
  49      =1  {
  50      =1          char* pSend;
  51      =1          char* pRecv;
  52      =1          uint16_t WaitTimes;
  53      =1          event pFunc;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 51  

  54      =1  }AT_Command;
  55      =1  
  56      =1  void AT_SetWap(char* ssid,char* key);
  57      =1  void AT_SetWsta(char* ssid,char* key);
  58      =1  
  59      =1  
  60      =1  /**
  61      =1   * @brief       初始化WIFI模块
  62      =1   * @details     
  63      =1   * @param       None
  64      =1   * @retval      None
  65      =1   */
  66      =1  extern void Wifi_Init(void);
  67      =1  
  68      =1  /**
  69      =1   * @brief       WIFI模块启停
  70      =1   * @details     
  71      =1   * @param       status:状态
  72      =1   * @retval      None
  73      =1   */
  74      =1  extern void Wifi_Enable(uint8_t status);
  75      =1  
  76      =1  /**
  77      =1   * @brief       WIFI模块执行指令表中特定指令
  78      =1   * @details     
  79      =1   * @param       None
  80      =1   * @retval      None
  81      =1   */
  82      =1  static void Exe_Appoint_Cmd(uint8_t *str, uint16_t times);
  83      =1  
  84      =1  /**
  85      =1   * @brief       打开WIFI模块热点
  86      =1   * @details     
  87      =1   * @param       None
  88      =1   * @retval      None
  89      =1   */
  90      =1  extern void Wifi_Open_Ap(void);
  91      =1  
  92      =1  /**
  93      =1   * @brief       关闭WIFI模块热点
  94      =1   * @details     
  95      =1   * @param       None
  96      =1   * @retval      None
  97      =1   */
  98      =1  extern void Wifi_Close_Ap(void);
  99      =1  
 100      =1  #ifdef  __cplusplus
           =1 }
           =1 #endif
 103      =1  
 104      =1  #endif  /* _WIFI_H_ */
 105      =1  
   6          
   7          #if (DEBUGGING == 1)
              void HardDefault(uint8_t channel, uint8_t error);
              #endif
  10          void Event_Init(void);
  11          static void Event_Polling(void);
  12          static void Debug_Task(void);
  13          static void ReadAdc_Task(void);
  14          static void Charging_Handle_Task(void);
  15          static void Report_Task(void);
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 52  

  16          
  17          /*禁止编译器优化该模块*/
  18          #pragma OPTIMIZE(0)
  19          
  20          /*软定时器任务事件组*/
  21          TIMERS timers_handle[] =
  22              {
  23          #if (DEBUGGING == 1)
                      {0, 100, true, false, Debug_Task          }, /*调试接口（3s）*/
              #else
  26                  {0, 50,  true, false, ReadAdc_Task        }, /*轮询读取通道中充电信息（500ms）*/
  27                  {0, 10,  true, false, Charging_Handle_Task}, /*充电事件处理任务（100ms）*/
  28                  {0, 100, true, false, Report_Task         }, /*上报充电器数据到迪文屏幕（1.0s）*/
  29          #endif
  30          };
  31          /*获得当前软件定时器个数*/
  32          const uint8_t g_TimerNumbers = sizeof(timers_handle) / sizeof(TIMERS);
  33          
  34          void main(void)
  35          {       
  36   1              /*设置WiFi芯片复引脚：不复位会导致连接不上云平台*/
  37   1              WIFI_RESET = 0;
  38   1          Delay_Ms(200);
  39   1              WIFI_RESET = 1;
  40   1              WIFI_RELOAD = 1;
  41   1          /*初始化引脚*/
  42   1          Gpio_Init();
  43   1          /*定时器0初始化*/
  44   1          Timer0_Init();
  45   1          /*串口1初始化*/
  46   1          Uart1_Init();
  47   1          /*串口2初始化*/
  48   1          Uart2_Init();
  49   1              /*WiFi初始化*/
  50   1      //      Wifi_Init();
  51   1          /*定时事件初始化*/
  52   1          Event_Init();
  53   1          /*初始化SC8913*/
  54   1          Sc8913_Init();
  55   1          /*开总中断*/
  56   1          OPEN_GLOBAL_OUTAGE();
  57   1          while (1)
  58   1          {
  59   2              ET0 = 0;
  60   2              Event_Polling();
  61   2              ET0 = 1;
  62   2          }
  63   1      }
  64          
  65          /**
  66           * @brief       把当前定义任务加载到任务组
  67           * @details     任务注册
  68           * @param       None
  69           * @retval      None
  70           */
  71          void Event_Init(void)
  72          {
  73   1          data uint8_t a = 0;
  74   1          for (a = 0; a < g_TimerNumbers; a++)
  75   1          {
  76   2              Timer_Group[a].timercnt = timers_handle[a].timercnt;
  77   2              Timer_Group[a].targetcnt = timers_handle[a].targetcnt;
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 53  

  78   2              Timer_Group[a].enable = timers_handle[a].enable;
  79   2              Timer_Group[a].execute_flag = timers_handle[a].execute_flag;
  80   2              Timer_Group[a].ehandle = timers_handle[a].ehandle;
  81   2          }
  82   1      }
  83          
  84          /**
  85           * @brief       任务组时间片调度
  86           * @details     按照指定时间片和执行标志调度任务
  87           * @param       None
  88           * @retval      None
  89           */
  90          /*变量出现问题，加static*/
  91          // #pragma disable
  92          void Event_Polling(void)
  93          {
  94   1          data uint8_t b = 0;
  95   1          /*执行标志*/
  96   1          for (b = 0; b < g_TimerNumbers; b++)
  97   1          {
  98   2              if (Timer_Group[b].execute_flag == true)
  99   2              {
 100   3                  Timer_Group[b].ehandle();
 101   3                  Timer_Group[b].execute_flag = false;
 102   3              }
 103   2          }
 104   1      }
 105          
 106          #if (DEBUGGING == 1)
              /**
               * @brief       调试任务
               * @details     调试阶段输出调试信息
               * @param       None
               * @retval      None
               */
              void Debug_Task(void)
              {
                  data uint8_t c = 0;
              
                  for (c = 0; c < CHANNEL_MAX; c++)
                  {
                      Uartx_Printf(&Uart1, "channel %bd :STATU is 0x%x\r\n", c, (uint8_t)g_Sc8913_Registers[c][STATUS_AD
             -DR]);
                      Uartx_Printf(&Uart1, "channel %bd :VBUS is %f\r\n", c, READ_VBUS_VALUE(c, VBUS_FB_VALUE_ADDR));
                      Uartx_Printf(&Uart1, "channel %bd :VBAT is %f\r\n", c, READ_VBAT_VALUE(c, VBAT_FB_VALUE_ADDR));
                      Uartx_Printf(&Uart1, "channel %bd :IBUS is %f\r\n", c, READ_IBUS_VALUE(c, IBUS_VALUE_ADDR));
                      Uartx_Printf(&Uart1, "channel %bd :IBAT is %f\r\n", c, READ_IBAT_VALUE(c, IBAT_VALUE_ADDR));
                  }
              }
              #endif
 127          
 128          /**
 129           * @brief       通道数据采集任务
 130           * @details     轮询模式，寄存器采用连续读模式
 131           * @param       None
 132           * @retval      None
 133           */
 134          void ReadAdc_Task(void)
 135          {
 136   1          data uint8_t h = 0;
 137   1          /*轮询获取对应通道下采样寄存器信息*/
 138   1          for (h = 0; h < CHANNEL_MAX; h++)
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 54  

 139   1          {
 140   2              if (Read_Register_Value(h) == REG_FAILE)
 141   2              { /*如果检测到硬件错误，进行记录，并继续下一个*/
 142   3      #if (DEBUGGING == 1)
                          HardDefault(h, REG_FAILE);
              #endif
 145   3                  continue;
 146   3              }
 147   2          }
 148   1      }
 149          
 150          /**
 151           * @brief       充电事件处理任务
 152           * @details     轮询模式
 153           * @param       None
 154           * @retval      None
 155           */
 156          void Charging_Handle_Task(void)
 157          {
 158   1          uint8_t m = 0;
 159   1      
 160   1          for (m = 0; m < CHANNEL_MAX; m++)
 161   1          {
 162   2              Charging_Poll(&g_Charger[m]);
 163   2          }
 164   1      }
 165          
 166          /**
 167           * @brief       迪文屏幕数据上报任务
 168           * @details     轮询模式
 169           * @param       None
 170           * @retval      None
 171           */
 172          void Report_Task(void)
 173          {
 174   1          uint8_t n = 0;
 175   1      
 176   1          for (n = 0; n < CHANNEL_MAX; n++)
 177   1          {
 178   2              Report_ChargerInfo(&g_Charger[n]);
 179   2          }
 180   1      }
 181          
 182          #if (DEBUGGING == 1)
              /**
               * @brief       硬件错误检测
               * @details     轮询模式
               * @param       None
               * @retval      None
               */
              void HardDefault(uint8_t channel, uint8_t error)
              {
                  Uartx_Printf(&Uart1,"\r\nChannel %bd product a error:%bd\r\n", channel , error);
              }
              #endif
 194          
 195          /************************************外设初始化************************************/
 196          /**
 197           * @brief       GPIO初始化
 198           * @details     初始化对应的外设引脚
 199           * @param       None
 200           * @retval      None
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 55  

 201           */
 202          void Gpio_Init(void)
 203          {
 204   1          GPIO_InitTypeDef GPIO_InitStruct = {0};
 205   1          //    #ifdef EXTERNAL_CRYSTAL //只要有宏名，就成立
 206   1      #if EXTERNAL_CRYSTAL
                  P_SW2 = 0x80;
                  XOSCCR = 0xC0;
                  /*启动外部晶振11.0592MHz*/
                  while (!(XOSCCR & 1))
                      ;
                  /*时钟不分频*/
                  CLKDIV = 0x01;
                  /*选择外部晶振*/
                  CKSEL = 0x01;
                  P_SW2 = 0x00;
              #endif
 218   1          //  P_SW1 = 0xC0; //串口1切换到P4.3、4.4(P0.2、0.3)
 219   1          //  P_SW2 |= 0x01; //串口2切换到P4.0、4.2(P1.0、1.1)（新板子引脚问题）
 220   1      
 221   1          /*手册提示，串口1、2、3、4的发送引脚必须设置为强挽输出*/
 222   1          /*设置P0.0、 P0.1、P0.5为开漏输出*/
 223   1          GPIO_InitStruct.Mode = GPIO_OUT_OD;
 224   1          GPIO_InitStruct.Pin = GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_5;
 225   1          GPIO_Inilize(GPIO_P0, &GPIO_InitStruct);
 226   1          /*设置P1.0为准双向口*/
 227   1          GPIO_InitStruct.Mode = GPIO_PullUp;
 228   1          GPIO_InitStruct.Pin = GPIO_Pin_0;
 229   1          GPIO_Inilize(GPIO_P1, &GPIO_InitStruct);
 230   1          /*设置P1.1为推免输出*/
 231   1          GPIO_InitStruct.Mode = GPIO_OUT_PP;
 232   1          GPIO_InitStruct.Pin = GPIO_Pin_1;
 233   1          GPIO_Inilize(GPIO_P1, &GPIO_InitStruct);
 234   1          /*设置P1.2、P1.3、 P1.4、P1.5为开漏输出*/
 235   1          GPIO_InitStruct.Mode = GPIO_OUT_OD;
 236   1          GPIO_InitStruct.Pin = GPIO_Pin_2 | GPIO_Pin_3 |GPIO_Pin_4 | GPIO_Pin_5;
 237   1          GPIO_Inilize(GPIO_P1, &GPIO_InitStruct);
 238   1          /*设置P2.7为开漏输出*/
 239   1          GPIO_InitStruct.Mode = GPIO_OUT_OD;
 240   1          GPIO_InitStruct.Pin = GPIO_Pin_7;
 241   1          GPIO_Inilize(GPIO_P2, &GPIO_InitStruct);
 242   1          /*设置P3.0为准双向口*/
 243   1          GPIO_InitStruct.Mode = GPIO_PullUp;
 244   1          GPIO_InitStruct.Pin = GPIO_Pin_0;
 245   1          GPIO_Inilize(GPIO_P3, &GPIO_InitStruct);
 246   1          /*设置P3.1为推免输出*/
 247   1          GPIO_InitStruct.Mode = GPIO_OUT_PP;
 248   1          GPIO_InitStruct.Pin = GPIO_Pin_1;
 249   1          GPIO_Inilize(GPIO_P3, &GPIO_InitStruct);
 250   1          /*设置P4.4为开漏输出*/
 251   1          GPIO_InitStruct.Mode = GPIO_OUT_OD;
 252   1          GPIO_InitStruct.Pin = GPIO_Pin_4;
 253   1          GPIO_Inilize(GPIO_P4, &GPIO_InitStruct);
 254   1      }
 255          /************************************外设初始化************************************/
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 56  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 34
                                           ; SOURCE LINE # 35
                                           ; SOURCE LINE # 37
0000 C2A3              CLR     P23
                                           ; SOURCE LINE # 38
0002 7FC8              MOV     R7,#0C8H
0004 7E00              MOV     R6,#00H
0006 120000      E     LCALL   _Delay_Ms
                                           ; SOURCE LINE # 39
0009 D2A3              SETB    P23
                                           ; SOURCE LINE # 40
000B D2A0              SETB    P20
                                           ; SOURCE LINE # 42
000D 120000      R     LCALL   Gpio_Init
                                           ; SOURCE LINE # 44
0010 120000      E     LCALL   Timer0_Init
                                           ; SOURCE LINE # 46
0013 120000      E     LCALL   Uart1_Init
                                           ; SOURCE LINE # 48
0016 120000      E     LCALL   Uart2_Init
                                           ; SOURCE LINE # 52
0019 120000      R     LCALL   Event_Init
                                           ; SOURCE LINE # 54
001C 120000      E     LCALL   Sc8913_Init
                                           ; SOURCE LINE # 56
001F D2AF              SETB    EA
0021         ?C0001:
                                           ; SOURCE LINE # 57
                                           ; SOURCE LINE # 58
                                           ; SOURCE LINE # 59
0021 C2A9              CLR     ET0
                                           ; SOURCE LINE # 60
0023 120000      R     LCALL   Event_Polling
                                           ; SOURCE LINE # 61
0026 D2A9              SETB    ET0
                                           ; SOURCE LINE # 62
0028 80F7              SJMP    ?C0001
002A 22                RET     
             ; FUNCTION main (END)

             ; FUNCTION Event_Init (BEGIN)
                                           ; SOURCE LINE # 71
                                           ; SOURCE LINE # 72
                                           ; SOURCE LINE # 73
0000 750000      R     MOV     a,#00H
                                           ; SOURCE LINE # 74
0003 750000      R     MOV     a,#00H
0006         ?C0004:
0006 900000      R     MOV     DPTR,#g_TimerNumbers
0009 E0                MOVX    A,@DPTR
000A FF                MOV     R7,A
000B E500        R     MOV     A,a
000D C3                CLR     C
000E 9F                SUBB    A,R7
000F 4003              JC      $ + 5H
0011 020000      R     LJMP    ?C0007
                                           ; SOURCE LINE # 75
                                           ; SOURCE LINE # 76
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 57  

0014 AF00        R     MOV     R7,a
0016 EF                MOV     A,R7
0017 75F009            MOV     B,#09H
001A A4                MUL     AB
001B 2400        R     ADD     A,#LOW timers_handle
001D F582              MOV     DPL,A
001F E4                CLR     A
0020 3400        R     ADDC    A,#HIGH timers_handle
0022 F583              MOV     DPH,A
0024 E0                MOVX    A,@DPTR
0025 FE                MOV     R6,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FF                MOV     R7,A
0029 AD00        R     MOV     R5,a
002B 75F009            MOV     B,#09H
002E ED                MOV     A,R5
002F A4                MUL     AB
0030 2400        E     ADD     A,#LOW Timer_Group
0032 F582              MOV     DPL,A
0034 E5F0              MOV     A,B
0036 3400        E     ADDC    A,#HIGH Timer_Group
0038 F583              MOV     DPH,A
003A EE                MOV     A,R6
003B F0                MOVX    @DPTR,A
003C A3                INC     DPTR
003D EF                MOV     A,R7
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 77
003F AF00        R     MOV     R7,a
0041 EF                MOV     A,R7
0042 75F009            MOV     B,#09H
0045 A4                MUL     AB
0046 2400        R     ADD     A,#LOW timers_handle+02H
0048 F582              MOV     DPL,A
004A E4                CLR     A
004B 3400        R     ADDC    A,#HIGH timers_handle+02H
004D F583              MOV     DPH,A
004F E0                MOVX    A,@DPTR
0050 FE                MOV     R6,A
0051 A3                INC     DPTR
0052 E0                MOVX    A,@DPTR
0053 FF                MOV     R7,A
0054 AD00        R     MOV     R5,a
0056 75F009            MOV     B,#09H
0059 ED                MOV     A,R5
005A A4                MUL     AB
005B 2400        E     ADD     A,#LOW Timer_Group+02H
005D F582              MOV     DPL,A
005F E5F0              MOV     A,B
0061 3400        E     ADDC    A,#HIGH Timer_Group+02H
0063 F583              MOV     DPH,A
0065 EE                MOV     A,R6
0066 F0                MOVX    @DPTR,A
0067 A3                INC     DPTR
0068 EF                MOV     A,R7
0069 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 78
006A AF00        R     MOV     R7,a
006C EF                MOV     A,R7
006D 75F009            MOV     B,#09H
0070 A4                MUL     AB
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 58  

0071 2400        R     ADD     A,#LOW timers_handle+04H
0073 F582              MOV     DPL,A
0075 E4                CLR     A
0076 3400        R     ADDC    A,#HIGH timers_handle+04H
0078 F583              MOV     DPH,A
007A E0                MOVX    A,@DPTR
007B FF                MOV     R7,A
007C AE00        R     MOV     R6,a
007E 75F009            MOV     B,#09H
0081 EE                MOV     A,R6
0082 A4                MUL     AB
0083 2400        E     ADD     A,#LOW Timer_Group+04H
0085 F582              MOV     DPL,A
0087 E5F0              MOV     A,B
0089 3400        E     ADDC    A,#HIGH Timer_Group+04H
008B F583              MOV     DPH,A
008D EF                MOV     A,R7
008E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 79
008F AF00        R     MOV     R7,a
0091 EF                MOV     A,R7
0092 75F009            MOV     B,#09H
0095 A4                MUL     AB
0096 2400        R     ADD     A,#LOW timers_handle+05H
0098 F582              MOV     DPL,A
009A E4                CLR     A
009B 3400        R     ADDC    A,#HIGH timers_handle+05H
009D F583              MOV     DPH,A
009F E0                MOVX    A,@DPTR
00A0 FF                MOV     R7,A
00A1 AE00        R     MOV     R6,a
00A3 75F009            MOV     B,#09H
00A6 EE                MOV     A,R6
00A7 A4                MUL     AB
00A8 2400        E     ADD     A,#LOW Timer_Group+05H
00AA F582              MOV     DPL,A
00AC E5F0              MOV     A,B
00AE 3400        E     ADDC    A,#HIGH Timer_Group+05H
00B0 F583              MOV     DPH,A
00B2 EF                MOV     A,R7
00B3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 80
00B4 AF00        R     MOV     R7,a
00B6 EF                MOV     A,R7
00B7 75F009            MOV     B,#09H
00BA A4                MUL     AB
00BB 2400        R     ADD     A,#LOW timers_handle+06H
00BD F582              MOV     DPL,A
00BF E4                CLR     A
00C0 3400        R     ADDC    A,#HIGH timers_handle+06H
00C2 F583              MOV     DPH,A
00C4 E0                MOVX    A,@DPTR
00C5 FB                MOV     R3,A
00C6 A3                INC     DPTR
00C7 E0                MOVX    A,@DPTR
00C8 FA                MOV     R2,A
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB F9                MOV     R1,A
00CC AF00        R     MOV     R7,a
00CE 75F009            MOV     B,#09H
00D1 EF                MOV     A,R7
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 59  

00D2 A4                MUL     AB
00D3 2400        E     ADD     A,#LOW Timer_Group+06H
00D5 F582              MOV     DPL,A
00D7 E5F0              MOV     A,B
00D9 3400        E     ADDC    A,#HIGH Timer_Group+06H
00DB F583              MOV     DPH,A
00DD EB                MOV     A,R3
00DE F0                MOVX    @DPTR,A
00DF A3                INC     DPTR
00E0 EA                MOV     A,R2
00E1 F0                MOVX    @DPTR,A
00E2 A3                INC     DPTR
00E3 E9                MOV     A,R1
00E4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 81
00E5 0500        R     INC     a
00E7 020000      R     LJMP    ?C0004
                                           ; SOURCE LINE # 82
00EA         ?C0007:
00EA 22                RET     
             ; FUNCTION Event_Init (END)

             ; FUNCTION Event_Polling (BEGIN)
                                           ; SOURCE LINE # 92
                                           ; SOURCE LINE # 93
                                           ; SOURCE LINE # 94
0000 750000      R     MOV     b,#00H
                                           ; SOURCE LINE # 96
0003 750000      R     MOV     b,#00H
0006         ?C0008:
0006 900000      R     MOV     DPTR,#g_TimerNumbers
0009 E0                MOVX    A,@DPTR
000A FF                MOV     R7,A
000B E500        R     MOV     A,b
000D C3                CLR     C
000E 9F                SUBB    A,R7
000F 504E              JNC     ?C0012
                                           ; SOURCE LINE # 97
                                           ; SOURCE LINE # 98
0011 AF00        R     MOV     R7,b
0013 75F009            MOV     B,#09H
0016 EF                MOV     A,R7
0017 A4                MUL     AB
0018 2400        E     ADD     A,#LOW Timer_Group+05H
001A F582              MOV     DPL,A
001C E5F0              MOV     A,B
001E 3400        E     ADDC    A,#HIGH Timer_Group+05H
0020 F583              MOV     DPH,A
0022 E0                MOVX    A,@DPTR
0023 FF                MOV     R7,A
0024 7E00              MOV     R6,#00H
0026 EF                MOV     A,R7
0027 6401              XRL     A,#01H
0029 4E                ORL     A,R6
002A 702F              JNZ     ?C0010
                                           ; SOURCE LINE # 99
                                           ; SOURCE LINE # 100
002C AF00        R     MOV     R7,b
002E 75F009            MOV     B,#09H
0031 EF                MOV     A,R7
0032 A4                MUL     AB
0033 2400        E     ADD     A,#LOW Timer_Group+06H
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 60  

0035 F582              MOV     DPL,A
0037 E5F0              MOV     A,B
0039 3400        E     ADDC    A,#HIGH Timer_Group+06H
003B F583              MOV     DPH,A
003D E0                MOVX    A,@DPTR
003E FB                MOV     R3,A
003F A3                INC     DPTR
0040 E0                MOVX    A,@DPTR
0041 FA                MOV     R2,A
0042 A3                INC     DPTR
0043 E0                MOVX    A,@DPTR
0044 F9                MOV     R1,A
0045 120000      E     LCALL   ?C?ICALL
                                           ; SOURCE LINE # 101
0048 AF00        R     MOV     R7,b
004A 75F009            MOV     B,#09H
004D EF                MOV     A,R7
004E A4                MUL     AB
004F 2400        E     ADD     A,#LOW Timer_Group+05H
0051 F582              MOV     DPL,A
0053 E5F0              MOV     A,B
0055 3400        E     ADDC    A,#HIGH Timer_Group+05H
0057 F583              MOV     DPH,A
0059 E4                CLR     A
005A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 103
005B         ?C0010:
005B 0500        R     INC     b
005D 80A7              SJMP    ?C0008
                                           ; SOURCE LINE # 104
005F         ?C0012:
005F 22                RET     
             ; FUNCTION Event_Polling (END)

             ; FUNCTION ReadAdc_Task (BEGIN)
                                           ; SOURCE LINE # 134
                                           ; SOURCE LINE # 135
                                           ; SOURCE LINE # 136
0000 750000      R     MOV     h,#00H
                                           ; SOURCE LINE # 138
0003 750000      R     MOV     h,#00H
0006         ?C0013:
0006 AF00        R     MOV     R7,h
0008 7E00              MOV     R6,#00H
000A C3                CLR     C
000B EF                MOV     A,R7
000C 9403              SUBB    A,#03H
000E EE                MOV     A,R6
000F 6480              XRL     A,#080H
0011 9480              SUBB    A,#080H
0013 5009              JNC     ?C0017
                                           ; SOURCE LINE # 139
                                           ; SOURCE LINE # 140
0015 AF00        R     MOV     R7,h
0017 120000      E     LCALL   _Read_Register_Value
                                           ; SOURCE LINE # 141
                                           ; SOURCE LINE # 145
                                           ; SOURCE LINE # 146
                                           ; SOURCE LINE # 147
001A 0500        R     INC     h
001C 80E8              SJMP    ?C0013
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 61  

                                           ; SOURCE LINE # 148
001E         ?C0017:
001E 22                RET     
             ; FUNCTION ReadAdc_Task (END)

             ; FUNCTION Charging_Handle_Task (BEGIN)
                                           ; SOURCE LINE # 156
                                           ; SOURCE LINE # 157
                                           ; SOURCE LINE # 158
0000 900000      R     MOV     DPTR,#m
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 160
0005 900000      R     MOV     DPTR,#m
0008 E4                CLR     A
0009 F0                MOVX    @DPTR,A
000A         ?C0018:
000A 900000      R     MOV     DPTR,#m
000D E0                MOVX    A,@DPTR
000E FF                MOV     R7,A
000F 7E00              MOV     R6,#00H
0011 C3                CLR     C
0012 EF                MOV     A,R7
0013 9403              SUBB    A,#03H
0015 EE                MOV     A,R6
0016 6480              XRL     A,#080H
0018 9480              SUBB    A,#080H
001A 5023              JNC     ?C0021
                                           ; SOURCE LINE # 161
                                           ; SOURCE LINE # 162
001C 900000      R     MOV     DPTR,#m
001F E0                MOVX    A,@DPTR
0020 FF                MOV     R7,A
0021 7E3F              MOV     R6,#03FH
0023 EF                MOV     A,R7
0024 8EF0              MOV     B,R6
0026 A4                MUL     AB
0027 FF                MOV     R7,A
0028 AEF0              MOV     R6,B
002A 7400        E     MOV     A,#LOW g_Charger
002C 2F                ADD     A,R7
002D F9                MOV     R1,A
002E 7400        E     MOV     A,#HIGH g_Charger
0030 3E                ADDC    A,R6
0031 FA                MOV     R2,A
0032 7B01              MOV     R3,#01H
0034 120000      E     LCALL   _Charging_Poll
                                           ; SOURCE LINE # 163
0037 900000      R     MOV     DPTR,#m
003A E0                MOVX    A,@DPTR
003B 04                INC     A
003C F0                MOVX    @DPTR,A
003D 80CB              SJMP    ?C0018
                                           ; SOURCE LINE # 164
003F         ?C0021:
003F 22                RET     
             ; FUNCTION Charging_Handle_Task (END)

             ; FUNCTION Report_Task (BEGIN)
                                           ; SOURCE LINE # 172
                                           ; SOURCE LINE # 173
                                           ; SOURCE LINE # 174
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 62  

0000 900000      R     MOV     DPTR,#n
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 176
0005 900000      R     MOV     DPTR,#n
0008 E4                CLR     A
0009 F0                MOVX    @DPTR,A
000A         ?C0022:
000A 900000      R     MOV     DPTR,#n
000D E0                MOVX    A,@DPTR
000E FF                MOV     R7,A
000F 7E00              MOV     R6,#00H
0011 C3                CLR     C
0012 EF                MOV     A,R7
0013 9403              SUBB    A,#03H
0015 EE                MOV     A,R6
0016 6480              XRL     A,#080H
0018 9480              SUBB    A,#080H
001A 5023              JNC     ?C0025
                                           ; SOURCE LINE # 177
                                           ; SOURCE LINE # 178
001C 900000      R     MOV     DPTR,#n
001F E0                MOVX    A,@DPTR
0020 FF                MOV     R7,A
0021 7E3F              MOV     R6,#03FH
0023 EF                MOV     A,R7
0024 8EF0              MOV     B,R6
0026 A4                MUL     AB
0027 FF                MOV     R7,A
0028 AEF0              MOV     R6,B
002A 7400        E     MOV     A,#LOW g_Charger
002C 2F                ADD     A,R7
002D F9                MOV     R1,A
002E 7400        E     MOV     A,#HIGH g_Charger
0030 3E                ADDC    A,R6
0031 FA                MOV     R2,A
0032 7B01              MOV     R3,#01H
0034 120000      E     LCALL   _Report_ChargerInfo
                                           ; SOURCE LINE # 179
0037 900000      R     MOV     DPTR,#n
003A E0                MOVX    A,@DPTR
003B 04                INC     A
003C F0                MOVX    @DPTR,A
003D 80CB              SJMP    ?C0022
                                           ; SOURCE LINE # 180
003F         ?C0025:
003F 22                RET     
             ; FUNCTION Report_Task (END)

             ; FUNCTION Gpio_Init (BEGIN)
                                           ; SOURCE LINE # 202
                                           ; SOURCE LINE # 203
                                           ; SOURCE LINE # 204
0000 7BFF              MOV     R3,#0FFH
0002 7A00        R     MOV     R2,#HIGH _?ix1000
0004 7900        R     MOV     R1,#LOW _?ix1000
0006 C003              PUSH    AR3
0008 C002              PUSH    AR2
000A C001              PUSH    AR1
000C 7B01              MOV     R3,#01H
000E 7A00        R     MOV     R2,#HIGH GPIO_InitStruct
0010 7900        R     MOV     R1,#LOW GPIO_InitStruct
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 63  

0012 A801              MOV     R0,AR1
0014 AC02              MOV     R4,AR2
0016 AD03              MOV     R5,AR3
0018 D001              POP     AR1
001A D002              POP     AR2
001C D003              POP     AR3
001E 7E00              MOV     R6,#00H
0020 7F02              MOV     R7,#02H
0022 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 223
0025 900000      R     MOV     DPTR,#GPIO_InitStruct
0028 7402              MOV     A,#02H
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 224
002B 900000      R     MOV     DPTR,#GPIO_InitStruct+01H
002E 7423              MOV     A,#023H
0030 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 225
0031 7B01              MOV     R3,#01H
0033 7A00        R     MOV     R2,#HIGH GPIO_InitStruct
0035 7900        R     MOV     R1,#LOW GPIO_InitStruct
0037 7F00              MOV     R7,#00H
0039 120000      E     LCALL   _GPIO_Inilize
                                           ; SOURCE LINE # 227
003C 900000      R     MOV     DPTR,#GPIO_InitStruct
003F E4                CLR     A
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 228
0041 900000      R     MOV     DPTR,#GPIO_InitStruct+01H
0044 7401              MOV     A,#01H
0046 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 229
0047 7B01              MOV     R3,#01H
0049 7A00        R     MOV     R2,#HIGH GPIO_InitStruct
004B 7900        R     MOV     R1,#LOW GPIO_InitStruct
004D 7F01              MOV     R7,#01H
004F 120000      E     LCALL   _GPIO_Inilize
                                           ; SOURCE LINE # 231
0052 900000      R     MOV     DPTR,#GPIO_InitStruct
0055 7403              MOV     A,#03H
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 232
0058 900000      R     MOV     DPTR,#GPIO_InitStruct+01H
005B 7402              MOV     A,#02H
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 233
005E 7B01              MOV     R3,#01H
0060 7A00        R     MOV     R2,#HIGH GPIO_InitStruct
0062 7900        R     MOV     R1,#LOW GPIO_InitStruct
0064 7F01              MOV     R7,#01H
0066 120000      E     LCALL   _GPIO_Inilize
                                           ; SOURCE LINE # 235
0069 900000      R     MOV     DPTR,#GPIO_InitStruct
006C 7402              MOV     A,#02H
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 236
006F 900000      R     MOV     DPTR,#GPIO_InitStruct+01H
0072 743C              MOV     A,#03CH
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 237
0075 7B01              MOV     R3,#01H
0077 7A00        R     MOV     R2,#HIGH GPIO_InitStruct
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 64  

0079 7900        R     MOV     R1,#LOW GPIO_InitStruct
007B 7F01              MOV     R7,#01H
007D 120000      E     LCALL   _GPIO_Inilize
                                           ; SOURCE LINE # 239
0080 900000      R     MOV     DPTR,#GPIO_InitStruct
0083 7402              MOV     A,#02H
0085 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 240
0086 900000      R     MOV     DPTR,#GPIO_InitStruct+01H
0089 7480              MOV     A,#080H
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 241
008C 7B01              MOV     R3,#01H
008E 7A00        R     MOV     R2,#HIGH GPIO_InitStruct
0090 7900        R     MOV     R1,#LOW GPIO_InitStruct
0092 7F02              MOV     R7,#02H
0094 120000      E     LCALL   _GPIO_Inilize
                                           ; SOURCE LINE # 243
0097 900000      R     MOV     DPTR,#GPIO_InitStruct
009A E4                CLR     A
009B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 244
009C 900000      R     MOV     DPTR,#GPIO_InitStruct+01H
009F 7401              MOV     A,#01H
00A1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 245
00A2 7B01              MOV     R3,#01H
00A4 7A00        R     MOV     R2,#HIGH GPIO_InitStruct
00A6 7900        R     MOV     R1,#LOW GPIO_InitStruct
00A8 7F03              MOV     R7,#03H
00AA 120000      E     LCALL   _GPIO_Inilize
                                           ; SOURCE LINE # 247
00AD 900000      R     MOV     DPTR,#GPIO_InitStruct
00B0 7403              MOV     A,#03H
00B2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 248
00B3 900000      R     MOV     DPTR,#GPIO_InitStruct+01H
00B6 7402              MOV     A,#02H
00B8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 249
00B9 7B01              MOV     R3,#01H
00BB 7A00        R     MOV     R2,#HIGH GPIO_InitStruct
00BD 7900        R     MOV     R1,#LOW GPIO_InitStruct
00BF 7F03              MOV     R7,#03H
00C1 120000      E     LCALL   _GPIO_Inilize
                                           ; SOURCE LINE # 251
00C4 900000      R     MOV     DPTR,#GPIO_InitStruct
00C7 7402              MOV     A,#02H
00C9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 252
00CA 900000      R     MOV     DPTR,#GPIO_InitStruct+01H
00CD 7410              MOV     A,#010H
00CF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 253
00D0 7B01              MOV     R3,#01H
00D2 7A00        R     MOV     R2,#HIGH GPIO_InitStruct
00D4 7900        R     MOV     R1,#LOW GPIO_InitStruct
00D6 7F04              MOV     R7,#04H
00D8 120000      E     LCALL   _GPIO_Inilize
                                           ; SOURCE LINE # 254
00DB 22                RET     
             ; FUNCTION Gpio_Init (END)
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 65  


C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 66  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


uint16_t . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
Constant_Current_Mode. . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
P0 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0080H  1
Four_Cell. . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
P1 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0090H  1
Cell . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
R_20m. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
High . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
P2 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A0H  1
Background_Parameters. . . . . . . . .  TYPEDEF  -----  STRUCT   -----  24
  Trickle_Target_Current . . . . . . .  MEMBER   -----  FLOAT    0000H  4
  Trickle_Target_Voltage . . . . . . .  MEMBER   -----  FLOAT    0004H  4
  ConstantCurrent_Target_Current . . .  MEMBER   -----  FLOAT    0008H  4
  ConstantCurrent_Target_Voltage . . .  MEMBER   -----  FLOAT    000CH  4
  ConstantVoltage_Target_Current . . .  MEMBER   -----  FLOAT    0010H  4
  ConstantVoltage_Target_Voltage . . .  MEMBER   -----  FLOAT    0014H  4
T0_No_AutoReload_16bit . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
P3 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B0H  1
Sc8913_Init. . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
R_40m. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
T1_No_AutoReload_16bit . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
P4 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C0H  1
Vbat_IRCompensation. . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
Uart_HandleTypeDef . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  11
  Instance . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  Register_SCON. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  Uart_Mode. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  Uart_Count . . . . . . . . . . . . .  MEMBER   -----  U_INT    0003H  2
  RunUart_Enable . . . . . . . . . . .  MEMBER   -----  FIELD    0005H  1.0
  Interrupt_Enable . . . . . . . . . .  MEMBER   -----  U_CHAR   0006H  1
  Register_AUXR. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0007H  1
  Uartx_busy . . . . . . . . . . . . .  MEMBER   -----  FIELD    0008H  1.0
  Uart_NVIC. . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0009H  2
P5 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C8H  1
Vbat_Units . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
One_Cell . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
EA . . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00AFH  1
P6 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00E8H  1
int32_t. . . . . . . . . . . . . . . .  TYPEDEF  -----  LONG     -----  4
P7 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00F8H  1
g_Charger. . . . . . . . . . . . . . .  EXTERN   XDATA  ARRAY    -----  189
R_80m. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
Gpio_Init. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  GPIO_InitStruct. . . . . . . . . . .  AUTO     XDATA  STRUCT   0000H  2
T4T3M_Register . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  T4T3M. . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
_Read_Register_Value . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
Charging_State . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
IPH_Register . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  IPH. . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
Write. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
IE . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A8H  1
Both . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
VINRANG_SET_Register . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  VINRANG_SET_Type . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  VINRANG_SET_Addr . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  VINRANG_SET. . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 67  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


STATUS_Register. . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  STATUS_Type. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  STATUS_Addr. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  STATUS . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
S2CON_Register . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  S2CON. . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
size_t . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
_Delay_Ms. . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
S3CON_Register . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  S3CON. . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
S4CON_Register . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  S4CON. . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
IBAT_FB_VALUE_Register . . . . . . . .  TYPEDEF  -----  STRUCT   -----  5
  IBAT_FB_VALUE_Type . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  IBAT_FB_VALUE_Addr . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  IBAT_FB_VALUE. . . . . . . . . . . .  MEMBER   -----  UNION    0002H  3
IP . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B8H  1
Timer0_Mode. . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
Timer1_Mode. . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
Foreground_Parameters. . . . . . . . .  TYPEDEF  -----  STRUCT   -----  16
  Voltage. . . . . . . . . . . . . . .  MEMBER   -----  FLOAT    0000H  4
  Current. . . . . . . . . . . . . . .  MEMBER   -----  FLOAT    0004H  4
  Time . . . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   0008H  4
  Electricity. . . . . . . . . . . . .  MEMBER   -----  FLOAT    000CH  4
Two_Cell . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
I2CSLCR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  rI2CSLCR . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
End_Charging . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
I2CMSCR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  rI2CMSCR . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
_Charging_Poll . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
VBAT_FB_VALUE_Register . . . . . . . .  TYPEDEF  -----  STRUCT   -----  5
  VBAT_FB_VALUE_Type . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  VBAT_FB_VALUE_Addr . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  VBAT_FB_VALUE. . . . . . . . . . . .  MEMBER   -----  UNION    0002H  3
Reg_Type . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
T1_Timer1_Stop . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
CCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D8H  1
event. . . . . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
main . . . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
VBAT_SET_Register. . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  VBAT_SET_Type. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  VBAT_SET_Addr. . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  VBAT_SET . . . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
IBUS_FB_VALUE_Register . . . . . . . .  TYPEDEF  -----  STRUCT   -----  5
  IBUS_FB_VALUE_Type . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  IBUS_FB_VALUE_Addr . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  IBUS_FB_VALUE. . . . . . . . . . . .  MEMBER   -----  UNION    0002H  3
Timer_TypsDef. . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
Timer0_Init. . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
TIMER_NVIC_TypeDef . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  2
  IPH_Reg. . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0000H  1
  IP_Reg . . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0001H  1
RATIO_Register . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  RATIO_Type . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  RATIO_Addr . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  RATIO. . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 68  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


g_TimerNumbers . . . . . . . . . . . .  PUBLIC   XDATA  U_CHAR   0000H  1
WKTCH_Register . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  WKTCH. . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
_Report_ChargerInfo. . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
External_Mode. . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
P20. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A0H  1
Low. . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
TIMER0 . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
TIMER1 . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
PWMM0CR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMM0CR. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
SCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0098H  1
VBUS_FB_VALUE_Register . . . . . . . .  TYPEDEF  -----  STRUCT   -----  5
  VBUS_FB_VALUE_Type . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  VBUS_FB_VALUE_Addr . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  VBUS_FB_VALUE. . . . . . . . . . . .  MEMBER   -----  UNION    0002H  3
T0_AutoReload_8bit . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
TIMER2 . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
PWMM1CR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMM1CR. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
TCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0088H  1
P23. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A3H  1
T1_AutoReload_8bit . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
TIMER3 . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
PWMM2CR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMM2CR. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
PWMCR_Register . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMCR. . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
TIMER4 . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
PWMM3CR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMM3CR. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
T0_SAutoReload_16bit . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
PWMM4CR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMM4CR. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
AT_Command . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  11
  pSend. . . . . . . . . . . . . . . .  MEMBER   -----  PTR      0000H  3
  pRecv. . . . . . . . . . . . . . . .  MEMBER   -----  PTR      0003H  3
  WaitTimes. . . . . . . . . . . . . .  MEMBER   -----  U_INT    0006H  2
  pFunc. . . . . . . . . . . . . . . .  MEMBER   -----  PTR      0008H  3
PWMM5CR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMM5CR. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
IE_Register. . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  IE . . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
Trickle_Mode . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
PWMM6CR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMM6CR. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
PWMM7CR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMM7CR. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
Vbat_Units_Voltage . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
Event_Polling. . . . . . . . . . . . .  STATIC   CODE   PROC     0000H  -----
  b. . . . . . . . . . . . . . . . . .  STATIC   DATA   U_CHAR   0001H  1
IP2H_Register. . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  IP2H . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
PWMFDCR_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  PWMFDCR. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
CCAPM0_Register. . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  CCAPM0 . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 69  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


VBUSREF_I_SET_Register . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  VBUSREF_I_SET_Type . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  VBUSREF_I_SET_Addr . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  VBUSREF_I_SET. . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
Uart_TypsDef . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
CCAPM1_Register. . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  CCAPM1 . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
INTCLKO_Register . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  INTCLKO. . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
_?ix1000 . . . . . . . . . . . . . . .  STATIC   CODE   STRUCT   0000H  2
IIC_Pin_State. . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
CCAPM2_Register. . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  CCAPM2 . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
CCAPM3_Register. . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  CCAPM3 . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
IP_Register. . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  IP . . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
Uart1_Init . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
Inside_Mode. . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
Uart2_Init . . . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
ET0. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00A9H  1
V4_10. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
V4_20. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
V4_30. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
Charging_Handle_Task . . . . . . . . .  STATIC   CODE   PROC     0000H  -----
  m. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
V4_40. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
V4_50. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
R_0m . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
CMOD_Register. . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  CMOD . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
uint8_t. . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
V4_25. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
TIM_HandleTypeDef. . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  9
  Instance . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  AUXR_Reg . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0001H  1
  TMOD_Reg . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0002H  1
  Timer_Count. . . . . . . . . . . . .  MEMBER   -----  U_INT    0003H  2
  Timer_NVIC . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0005H  2
  IE_Reg . . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0007H  1
  TCON_Reg . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0008H  1
V4_35. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
V4_45. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
CMPCR1_Register. . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  CMPCR1 . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
stdantby_Mode. . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
TIMERS . . . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  9
  timercnt . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
  targetcnt. . . . . . . . . . . . . .  MEMBER   -----  U_INT    0002H  2
  enable . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
  execute_flag . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0005H  1
  ehandle. . . . . . . . . . . . . . .  MEMBER   -----  PTR      0006H  3
__IO . . . . . . . . . . . . . . . . .  TYPEDEF  -----  INT      -----  2
Device_Type. . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
MASK_Register. . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  MASK_Type. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  MASK_Addr. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 70  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  MASK . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
int8_t . . . . . . . . . . . . . . . .  TYPEDEF  -----  CHAR     -----  1
IBAT_LIM_SET_Register. . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  IBAT_LIM_SET_Type. . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  IBAT_LIM_SET_Addr. . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  IBAT_LIM_SET . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
Three_Cell . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
GPIO_InitTypeDef . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  2
  Mode . . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  Pin. . . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
Charging_Typedef . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  63
  Channel_Id . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  Dev_Type . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  Batterry_Numbers . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  CState . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  For_ChargingPara . . . . . . . . . .  MEMBER   -----  STRUCT   0004H  16
  Bac_ChargingPara . . . . . . . . . .  MEMBER   -----  STRUCT   0014H  24
  Charger_Show_Addr. . . . . . . . . .  MEMBER   -----  STRUCT   002CH  12
  Charger_Flag . . . . . . . . . . . .  MEMBER   -----  STRUCT   0038H  3
  Vbat_Ratio . . . . . . . . . . . . .  MEMBER   -----  FLOAT    003BH  4
CTRL0_SET_Register . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  CTRL0_SET_Type . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  CTRL0_SET_Addr . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  CTRL0_SET. . . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
SCON_Register. . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  SCON . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
CTRL1_SET_Register . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  CTRL1_SET_Type . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  CTRL1_SET_Addr . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  CTRL1_SET. . . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
TMOD_Register. . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  TMOD . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
TCON_Register. . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  TCON . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
CTRL2_SET_Register . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  CTRL2_SET_Type . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  CTRL2_SET_Addr . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  CTRL2_SET. . . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
CTRL3_SET_Register . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  CTRL3_SET_Type . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  CTRL3_SET_Addr . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  CTRL3_SET. . . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
T0_AutoReload_16bit. . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
UART_NVIC_TypeDef. . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  2
  Register_IP. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  Register_IPH . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
T1_AutoReload_16bit. . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
timers_handle. . . . . . . . . . . . .  PUBLIC   XDATA  ARRAY    0001H  27
AUXRINTIF_Register . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  AUXRINTIF. . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
_GPIO_Inilize. . . . . . . . . . . . .  EXTERN   CODE   PROC     -----  -----
IE2_Register . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  IE2. . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
AUXR_Register. . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  AUXR . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
wchar_t. . . . . . . . . . . . . . . .  TYPEDEF  -----  CHAR     -----  1
Channel0 . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
C51 COMPILER V9.60.0.0   MAIN                                                              01/05/2022 14:26:36 PAGE 71  

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


Constant_Voltage_Mode. . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
Channel1 . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
UART1. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
Dcdc . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
Channel2 . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
UART2. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
IBUS_LIM_SET_Register. . . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  IBUS_LIM_SET_Type. . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  IBUS_LIM_SET_Addr. . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  IBUS_LIM_SET . . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
UART3. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
No_Device. . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
UART4. . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1
IIC_Channel. . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
VBUSREF_I_SET2_Register. . . . . . . .  TYPEDEF  -----  STRUCT   -----  3
  VBUSREF_I_SET2_Type. . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
  VBUSREF_I_SET2_Addr. . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  VBUSREF_I_SET2 . . . . . . . . . . .  MEMBER   -----  UNION    0002H  1
Timer_Group. . . . . . . . . . . . . .  EXTERN   XDATA  ARRAY    -----  450
Report_Task. . . . . . . . . . . . . .  STATIC   CODE   PROC     0000H  -----
  n. . . . . . . . . . . . . . . . . .  AUTO     XDATA  U_CHAR   0000H  1
event_handle . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
Vbat_Mode. . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
IP2_Register . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  1
  IP2. . . . . . . . . . . . . . . . .  MEMBER   -----  UNION    0000H  1
va_list. . . . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
PSW. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D0H  1
Event_Init . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  a. . . . . . . . . . . . . . . . . .  STATIC   DATA   U_CHAR   0000H  1
uint32_t . . . . . . . . . . . . . . .  TYPEDEF  -----  U_LONG   -----  4
ReadAdc_Task . . . . . . . . . . . . .  STATIC   CODE   PROC     0000H  -----
  h. . . . . . . . . . . . . . . . . .  STATIC   DATA   U_CHAR   0002H  1
Read . . . . . . . . . . . . . . . . .  E_CONST  -----  U_CHAR   -----  1


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    753    ----
   CONSTANT SIZE    =      2    ----
   XDATA SIZE       =     32    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
